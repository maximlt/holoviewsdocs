
<!DOCTYPE html>

<html>
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>holoviews.core.options â€” HoloViews v1.14.7a1</title>
<link href="../../../_static/css/theme.css" rel="stylesheet"/>
<link href="../../../_static/css/index.ff1ffe594081f20da1ef19478df9384b.css" rel="stylesheet"/>
<link href="../../../_static/vendor/fontawesome/5.13.0/css/all.min.css" rel="stylesheet"/>
<link as="font" crossorigin="" href="../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2" rel="preload" type="font/woff2"/>
<link as="font" crossorigin="" href="../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2" rel="preload" type="font/woff2"/>
<link href="../../../_static/pygments.css" rel="stylesheet" type="text/css"/>
<link href="../../../_static/css/blank.css" rel="stylesheet" type="text/css"/>
<link href="../../../_static/togglebutton.css" rel="stylesheet" type="text/css"/>
<link href="../../../_static/mystnb.css" rel="stylesheet" type="text/css"/>
<link href="../../../_static/graphviz.css" rel="stylesheet" type="text/css"/>
<link href="../../../_static/copybutton.css" rel="stylesheet" type="text/css">
<link href="../../../_static/nbsite.css" rel="stylesheet" type="text/css">
<link href="../../../_static/css/custom.css" rel="stylesheet" type="text/css">
<link as="script" href="../../../_static/js/index.be7d3bbb2ef33a8344ce.js" rel="preload">
<script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
<script src="../../../_static/jquery.js"></script>
<script src="../../../_static/underscore.js"></script>
<script src="../../../_static/doctools.js"></script>
<script src="../../../_static/togglebutton.js"></script>
<script src="../../../_static/clipboard.min.js"></script>
<script src="../../../_static/copybutton.js"></script>
<script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
<link href="../../../_static/favicon.ico" rel="shortcut icon"/>
<link href="../../../about.html" rel="author" title="About these documents">
<link href="../../../genindex.html" rel="index" title="Index">
<link href="../../../search.html" rel="search" title="Search"/>
<meta content="width=device-width, initial-scale=1" name="viewport"/>
<meta content="None" name="docsearch:language"/>
<!-- Google Analytics -->
<script async="" src="https://www.google-analytics.com/analytics.js"></script>
<script>
                        window.ga = window.ga || function () {
                            (ga.q = ga.q || []).push(arguments) };
                        ga.l = +new Date;
                        ga('create', 'UA-61554933-1', 'auto');
                        ga('set', 'anonymizeIp', true);
                        ga('send', 'pageview');
                    </script>
</link></link></link></link></link></link></head>
<body data-offset="80" data-spy="scroll" data-target="#bd-toc-nav">
<div class="container-fluid" id="banner"></div>
<nav class="navbar navbar-light navbar-expand-lg bg-light fixed-top bd-navbar" id="navbar-main"><div class="container-xl">
<div id="navbar-start">
<a class="navbar-brand" href="../../../index.html">
<img alt="logo" class="logo" src="../../../_static/logo_horizontal.png"/>
</a>
</div>
<button aria-controls="navbar-collapsible" aria-expanded="false" aria-label="Toggle navigation" class="navbar-toggler" data-target="#navbar-collapsible" data-toggle="collapse" type="button">
<span class="navbar-toggler-icon"></span>
</button>
<div class="col-lg-9 collapse navbar-collapse" id="navbar-collapsible">
<div class="mr-auto" id="navbar-center">
<div class="navbar-center-item">
<ul class="navbar-nav" id="navbar-main-elements">
<li class="toctree-l1 nav-item">
<a class="reference internal nav-link" href="../../../index.html">
  Home
 </a>
</li>
<li class="toctree-l1 nav-item">
<a class="reference internal nav-link" href="../../../reference/index.html">
  Reference Gallery
 </a>
</li>
<li class="toctree-l1 nav-item">
<a class="reference internal nav-link" href="../../../releases.html">
  Releases
 </a>
</li>
<li class="toctree-l1 nav-item">
<a class="reference internal nav-link" href="../../../reference_manual/index.html">
  API
 </a>
</li>
<li class="toctree-l1 nav-item">
<a class="reference internal nav-link" href="../../../FAQ.html">
  FAQ
 </a>
</li>
<li class="toctree-l1 nav-item">
<a class="reference internal nav-link" href="../../../roadmap.html">
  Roadmap
 </a>
</li>
<li class="toctree-l1 nav-item">
<a class="reference external nav-link" href="https://github.com/holoviz/holoviews">
  Github source
 </a>
</li>
<li class="toctree-l1 nav-item">
<a class="reference internal nav-link" href="../../../about.html">
  About
 </a>
</li>
</ul>
</div>
</div>
<div id="navbar-end">
<div class="navbar-end-item">
<ul aria-label="Icon Links" class="navbar-nav" id="navbar-icon-links">
<li class="nav-item">
<a class="nav-link" href="https://github.com/holoviz/holoviews" rel="noopener" target="_blank" title="GitHub">
<span><i class="fab fa-github-square"></i></span>
<label class="sr-only">GitHub</label>
</a>
</li>
<li class="nav-item">
<a class="nav-link" href="https://twitter.com/holoviews" rel="noopener" target="_blank" title="Twitter">
<span><i class="fab fa-twitter-square"></i></span>
<label class="sr-only">Twitter</label>
</a>
</li>
<li class="nav-item">
<a class="nav-link" href="https://discourse.holoviz.org/" rel="noopener" target="_blank" title="Discourse">
<span><i class="fab fa-discourse"></i></span>
<label class="sr-only">Discourse</label>
</a>
</li>
</ul>
</div>
</div>
</div>
</div>
</nav>
<div class="container-xl">
<div class="row">
<!-- Only show if we have sidebars configured, else just a small margin  -->
<div class="col-12 col-md-3 bd-sidebar"><form action="../../../search.html" class="bd-search d-flex align-items-center" method="get">
<i class="icon fas fa-search"></i>
<input aria-label="Search the docs ..." autocomplete="off" class="form-control" id="search-input" name="q" placeholder="Search the docs ..." type="search"/>
</form><nav aria-label="Main navigation" class="bd-links" id="bd-docs-nav">
<div class="bd-toc-item active">
</div>
</nav>
</div>
<div class="d-none d-xl-block col-xl-2 bd-toc">
</div>
<main class="col-12 col-md-9 col-xl-7 py-md-5 pl-md-5 pr-md-4 bd-content" role="main">
<div>
<h1>Source code for holoviews.core.options</h1><div class="highlight"><pre>
<span></span><span class="sd">"""</span>
<span class="sd">Options and OptionTrees allow different classes of options</span>
<span class="sd">(e.g. matplotlib-specific styles and plot specific parameters) to be</span>
<span class="sd">defined separately from the core data structures and away from</span>
<span class="sd">visualization specific code.</span>

<span class="sd">There are three classes that form the options system:</span>

<span class="sd">Cycle:</span>

<span class="sd">   Used to define infinite cycles over a finite set of elements, using</span>
<span class="sd">   either an explicit list or some pre-defined collection (e.g. from</span>
<span class="sd">   matplotlib rcParams). For instance, a Cycle object can be used loop</span>
<span class="sd">   a set of display colors for multiple curves on a single axis.</span>

<span class="sd">Options:</span>

<span class="sd">   Containers of arbitrary keyword values, including optional keyword</span>
<span class="sd">   validation, support for Cycle objects and inheritance.</span>

<span class="sd">OptionTree:</span>

<span class="sd">   A subclass of AttrTree that is used to define the inheritance</span>
<span class="sd">   relationships between a collection of Options objects. Each node</span>
<span class="sd">   of the tree supports a group of Options objects and the leaf nodes</span>
<span class="sd">   inherit their keyword values from parent nodes up to the root.</span>

<span class="sd">Store:</span>

<span class="sd">   A singleton class that stores all global and custom options and</span>
<span class="sd">   links HoloViews objects, the chosen plotting backend and the IPython</span>
<span class="sd">   extension together.</span>

<span class="sd">"""</span>
<span class="kn">import</span> <span class="nn">difflib</span>
<span class="kn">import</span> <span class="nn">inspect</span>
<span class="kn">import</span> <span class="nn">pickle</span>
<span class="kn">import</span> <span class="nn">traceback</span>

<span class="kn">from</span> <span class="nn">contextlib</span> <span class="kn">import</span> <span class="n">contextmanager</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">defaultdict</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">param</span>

<span class="kn">from</span> <span class="nn">.accessors</span> <span class="kn">import</span> <span class="n">Opts</span> <span class="c1"># noqa (clean up in 2.0)</span>
<span class="kn">from</span> <span class="nn">.tree</span> <span class="kn">import</span> <span class="n">AttrTree</span>
<span class="kn">from</span> <span class="nn">.util</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">OrderedDict</span><span class="p">,</span> <span class="n">group_sanitizer</span><span class="p">,</span> <span class="n">label_sanitizer</span><span class="p">,</span> <span class="n">sanitize_identifier</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">.pprint</span> <span class="kn">import</span> <span class="n">InfoPrinter</span>


<div class="viewcode-block" id="cleanup_custom_options"><a class="viewcode-back" href="../../../reference_manual/holoviews.core.html#holoviews.core.io.cleanup_custom_options">[docs]</a><span class="k">def</span> <span class="nf">cleanup_custom_options</span><span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="n">weakref</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    Cleans up unused custom trees if all objects referencing the</span>
<span class="sd">    custom id have been garbage collected or tree is otherwise</span>
<span class="sd">    unreferenced.</span>
<span class="sd">    """</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">Store</span><span class="o">.</span><span class="n">_options_context</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="n">weakrefs</span> <span class="o">=</span> <span class="n">Store</span><span class="o">.</span><span class="n">_weakrefs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="p">[])</span>
        <span class="k">if</span> <span class="n">weakref</span> <span class="ow">in</span> <span class="n">weakrefs</span><span class="p">:</span>
            <span class="n">weakrefs</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">weakref</span><span class="p">)</span>
        <span class="n">refs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">wr</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">weakrefs</span><span class="p">):</span>
            <span class="n">r</span> <span class="o">=</span> <span class="n">wr</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">r</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">r</span><span class="o">.</span><span class="n">id</span> <span class="o">!=</span> <span class="nb">id</span><span class="p">:</span>
                <span class="n">weakrefs</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">wr</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">refs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">refs</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">bk</span> <span class="ow">in</span> <span class="n">Store</span><span class="o">.</span><span class="n">loaded_backends</span><span class="p">():</span>
                <span class="k">if</span> <span class="nb">id</span> <span class="ow">in</span> <span class="n">Store</span><span class="o">.</span><span class="n">_custom_options</span><span class="p">[</span><span class="n">bk</span><span class="p">]:</span>
                    <span class="n">Store</span><span class="o">.</span><span class="n">_custom_options</span><span class="p">[</span><span class="n">bk</span><span class="p">]</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">weakrefs</span><span class="p">:</span>
            <span class="n">Store</span><span class="o">.</span><span class="n">_weakrefs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">"Cleanup of custom options tree with id '</span><span class="si">{</span><span class="nb">id</span><span class="si">}</span><span class="s2">' failed "</span>
            <span class="sa">f</span><span class="s2">"with the following exception: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">, an unreferenced "</span>
            <span class="s2">"orphan tree may persist in memory."</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="lookup_options"><a class="viewcode-back" href="../../../reference_manual/holoviews.core.html#holoviews.core.io.lookup_options">[docs]</a><span class="k">def</span> <span class="nf">lookup_options</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">group</span><span class="p">,</span> <span class="n">backend</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    Given a HoloViews object, a plot option group (e.g. 'style') and</span>
<span class="sd">    backend, return the corresponding Options object.</span>
<span class="sd">    """</span>
    <span class="n">plot_class</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">plot_class</span> <span class="o">=</span> <span class="n">Store</span><span class="o">.</span><span class="n">renderers</span><span class="p">[</span><span class="n">backend</span><span class="p">]</span><span class="o">.</span><span class="n">plotting_class</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
        <span class="n">style_opts</span> <span class="o">=</span> <span class="n">plot_class</span><span class="o">.</span><span class="n">style_opts</span>
    <span class="k">except</span> <span class="n">SkipRendering</span><span class="p">:</span>
        <span class="n">style_opts</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="n">node</span> <span class="o">=</span> <span class="n">Store</span><span class="o">.</span><span class="n">lookup_options</span><span class="p">(</span><span class="n">backend</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">group</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">group</span> <span class="o">==</span> <span class="s1">'style'</span> <span class="ow">and</span> <span class="n">style_opts</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">node</span><span class="o">.</span><span class="n">filtered</span><span class="p">(</span><span class="n">style_opts</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">group</span> <span class="o">==</span> <span class="s1">'plot'</span> <span class="ow">and</span> <span class="n">plot_class</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">node</span><span class="o">.</span><span class="n">filtered</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">plot_class</span><span class="o">.</span><span class="n">param</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">node</span></div>


<div class="viewcode-block" id="CallbackError"><a class="viewcode-back" href="../../../reference_manual/holoviews.core.html#holoviews.core.io.CallbackError">[docs]</a><span class="k">class</span> <span class="nc">CallbackError</span><span class="p">(</span><span class="ne">RuntimeError</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    An error raised during a callback.</span>
<span class="sd">    """</span></div>


<div class="viewcode-block" id="SkipRendering"><a class="viewcode-back" href="../../../reference_manual/holoviews.core.html#holoviews.core.io.SkipRendering">[docs]</a><span class="k">class</span> <span class="nc">SkipRendering</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    A SkipRendering exception in the plotting code will make the display</span>
<span class="sd">    hooks fall back to a text repr. Used to skip rendering of</span>
<span class="sd">    DynamicMaps with exhausted element generators.</span>
<span class="sd">    """</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="s2">""</span><span class="p">,</span> <span class="n">warn</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">warn</span> <span class="o">=</span> <span class="n">warn</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">message</span><span class="p">)</span></div>


<div class="viewcode-block" id="OptionError"><a class="viewcode-back" href="../../../reference_manual/holoviews.core.html#holoviews.core.io.OptionError">[docs]</a><span class="k">class</span> <span class="nc">OptionError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    Custom exception raised when there is an attempt to apply invalid</span>
<span class="sd">    options. Stores the necessary information to construct a more</span>
<span class="sd">    readable message for the user if caught and processed</span>
<span class="sd">    appropriately.</span>
<span class="sd">    """</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">invalid_keyword</span><span class="p">,</span> <span class="n">allowed_keywords</span><span class="p">,</span>
                 <span class="n">group_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">message</span><span class="p">(</span><span class="n">invalid_keyword</span><span class="p">,</span>
                                      <span class="n">allowed_keywords</span><span class="p">,</span>
                                      <span class="n">group_name</span><span class="p">,</span> <span class="n">path</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">invalid_keyword</span> <span class="o">=</span> <span class="n">invalid_keyword</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">allowed_keywords</span> <span class="o">=</span> <span class="n">allowed_keywords</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">group_name</span> <span class="o">=</span><span class="n">group_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="n">path</span>

    <span class="k">def</span> <span class="nf">message</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">invalid_keyword</span><span class="p">,</span> <span class="n">allowed_keywords</span><span class="p">,</span> <span class="n">group_name</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span>
            <span class="sa">f</span><span class="s2">"Invalid option </span><span class="si">{</span><span class="n">invalid_keyword</span><span class="si">!r}</span><span class="s2">, valid options are: "</span>
            <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">allowed_keywords</span><span class="si">}</span><span class="s2">."</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">path</span> <span class="ow">and</span> <span class="n">group_name</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"Invalid key for group </span><span class="si">{</span><span class="n">group_name</span><span class="si">!r}</span><span class="s2"> on path </span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2">;</span><span class="se">\n</span><span class="si">{</span><span class="n">msg</span><span class="si">}</span><span class="s2">"</span>
        <span class="k">return</span> <span class="n">msg</span>

<div class="viewcode-block" id="OptionError.format_options_error"><a class="viewcode-back" href="../../../reference_manual/holoviews.core.html#holoviews.core.io.OptionError.format_options_error">[docs]</a>    <span class="k">def</span> <span class="nf">format_options_error</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        Return a fuzzy match message based on the OptionError</span>
<span class="sd">        """</span>
        <span class="n">allowed_keywords</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">allowed_keywords</span>
        <span class="n">target</span> <span class="o">=</span> <span class="n">allowed_keywords</span><span class="o">.</span><span class="n">target</span>
        <span class="n">matches</span> <span class="o">=</span> <span class="n">allowed_keywords</span><span class="o">.</span><span class="n">fuzzy_match</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">invalid_keyword</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">matches</span><span class="p">:</span>
            <span class="n">matches</span> <span class="o">=</span> <span class="n">allowed_keywords</span><span class="o">.</span><span class="n">values</span>
            <span class="n">similarity</span> <span class="o">=</span> <span class="s1">'Possible'</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">similarity</span> <span class="o">=</span> <span class="s1">'Similar'</span>

        <span class="n">loaded_backends</span> <span class="o">=</span> <span class="n">Store</span><span class="o">.</span><span class="n">loaded_backends</span><span class="p">()</span>
        <span class="n">target</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">'for </span><span class="si">{</span><span class="n">target</span><span class="si">}</span><span class="s1">'</span> <span class="k">if</span> <span class="n">target</span> <span class="k">else</span> <span class="s1">''</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">loaded_backends</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">loaded</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">' in loaded backend </span><span class="si">{</span><span class="n">loaded_backends</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">!r}</span><span class="s1">'</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">backend_list</span> <span class="o">=</span> <span class="s1">', '</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">repr</span><span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">loaded_backends</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]])</span>
            <span class="n">loaded</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">' in loaded backends </span><span class="si">{</span><span class="n">backend_list</span><span class="si">}</span><span class="s1"> and </span><span class="si">{</span><span class="n">loaded_backends</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">!r}</span><span class="s1">'</span>

        <span class="n">group</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">'</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">group_name</span><span class="si">}</span><span class="s1"> option'</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">group_name</span> <span class="k">else</span> <span class="s1">'keyword'</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="sa">f</span><span class="s2">"Unexpected </span><span class="si">{</span><span class="n">group</span><span class="si">}</span><span class="s2"> '</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">invalid_keyword</span><span class="si">}</span><span class="s2">' </span><span class="si">{</span><span class="n">target</span><span class="si">}</span><span class="s2">"</span>
            <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">loaded</span><span class="si">}</span><span class="s2">.</span><span class="se">\n\n</span><span class="si">{</span><span class="n">similarity</span><span class="si">}</span><span class="s2"> keywords in the currently "</span>
            <span class="sa">f</span><span class="s2">"active '</span><span class="si">{</span><span class="n">Store</span><span class="o">.</span><span class="n">current_backend</span><span class="si">}</span><span class="s2">' renderer are: "</span>
            <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">matches</span><span class="si">}</span><span class="se">\n\n</span><span class="s2">If you believe this keyword is correct, "</span>
            <span class="s2">"please make sure the backend has been imported or loaded "</span>
            <span class="s2">"with the hv.extension."</span>
        <span class="p">)</span></div></div>


<div class="viewcode-block" id="AbbreviatedException"><a class="viewcode-back" href="../../../reference_manual/holoviews.core.html#holoviews.core.io.AbbreviatedException">[docs]</a><span class="k">class</span> <span class="nc">AbbreviatedException</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    Raised by the abbreviate_exception context manager when it is</span>
<span class="sd">    appropriate to present an abbreviated the traceback and exception</span>
<span class="sd">    message in the notebook.</span>

<span class="sd">    Particularly useful when processing style options supplied by the</span>
<span class="sd">    user which may not be valid.</span>
<span class="sd">    """</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">etype</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">traceback</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">etype</span> <span class="o">=</span> <span class="n">etype</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">traceback</span> <span class="o">=</span> <span class="n">traceback</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">msg</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="sa">f</span><span class="s1">'</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">etype</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s1">: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">msg</span><span class="si">}</span><span class="se">\n\n</span><span class="s1">'</span>
            <span class="s1">'To view the original traceback, catch this exception and '</span>
            <span class="s1">'call print_traceback() method.'</span>
        <span class="p">)</span>

<div class="viewcode-block" id="AbbreviatedException.print_traceback"><a class="viewcode-back" href="../../../reference_manual/holoviews.core.html#holoviews.core.io.AbbreviatedException.print_traceback">[docs]</a>    <span class="k">def</span> <span class="nf">print_traceback</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        Print the traceback of the exception wrapped by the AbbreviatedException.</span>
<span class="sd">        """</span>
        <span class="n">traceback</span><span class="o">.</span><span class="n">print_exception</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">etype</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">traceback</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="abbreviated_exception"><a class="viewcode-back" href="../../../reference_manual/holoviews.core.html#holoviews.core.io.abbreviated_exception">[docs]</a><span class="k">class</span> <span class="nc">abbreviated_exception</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    Context manager used to to abbreviate tracebacks using an</span>
<span class="sd">    AbbreviatedException when a backend may raise an error due to</span>
<span class="sd">    incorrect style options.</span>
<span class="sd">    """</span>
    <span class="k">def</span> <span class="fm">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="fm">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">etype</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">traceback</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="ne">Exception</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">AbbreviatedException</span><span class="p">(</span><span class="n">etype</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">traceback</span><span class="p">)</span></div>


<div class="viewcode-block" id="options_policy"><a class="viewcode-back" href="../../../reference_manual/holoviews.core.html#holoviews.core.io.options_policy">[docs]</a><span class="nd">@contextmanager</span>
<span class="k">def</span> <span class="nf">options_policy</span><span class="p">(</span><span class="n">skip_invalid</span><span class="p">,</span> <span class="n">warn_on_skip</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    Context manager to temporarily set the skip_invalid and warn_on_skip</span>
<span class="sd">    class parameters on Options.</span>
<span class="sd">    """</span>
    <span class="n">settings</span> <span class="o">=</span> <span class="p">(</span><span class="n">Options</span><span class="o">.</span><span class="n">skip_invalid</span><span class="p">,</span> <span class="n">Options</span><span class="o">.</span><span class="n">warn_on_skip</span><span class="p">)</span>
    <span class="p">(</span><span class="n">Options</span><span class="o">.</span><span class="n">skip_invalid</span><span class="p">,</span> <span class="n">Options</span><span class="o">.</span><span class="n">warn_on_skip</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="n">skip_invalid</span><span class="p">,</span> <span class="n">warn_on_skip</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">yield</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="p">(</span><span class="n">Options</span><span class="o">.</span><span class="n">skip_invalid</span><span class="p">,</span> <span class="n">Options</span><span class="o">.</span><span class="n">warn_on_skip</span><span class="p">)</span> <span class="o">=</span> <span class="n">settings</span></div>


<div class="viewcode-block" id="Keywords"><a class="viewcode-back" href="../../../reference_manual/holoviews.core.html#holoviews.core.io.Keywords">[docs]</a><span class="k">class</span> <span class="nc">Keywords</span><span class="p">(</span><span class="n">param</span><span class="o">.</span><span class="n">Parameterized</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    A keywords objects represents a set of Python keywords. It is</span>
<span class="sd">    list-like and ordered but it is also a set without duplicates. When</span>
<span class="sd">    passed as **kwargs, Python keywords are not ordered but this class</span>
<span class="sd">    always lists keywords in sorted order.</span>

<span class="sd">    In addition to containing the list of keywords, Keywords has an</span>
<span class="sd">    optional target which describes what the keywords are applicable to.</span>

<span class="sd">    This class is for internal use only and should not be in the user</span>
<span class="sd">    namespace.</span>
<span class="sd">    """</span>

    <span class="n">values</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">List</span><span class="p">(</span><span class="n">doc</span><span class="o">=</span><span class="s2">"Set of keywords as a sorted list."</span><span class="p">)</span>

    <span class="n">target</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">String</span><span class="p">(</span><span class="n">allow_None</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">doc</span><span class="o">=</span><span class="s2">"""</span>
<span class="s2">       Optional string description of what the keywords apply to."""</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="p">[],</span> <span class="n">target</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>

        <span class="n">strings</span> <span class="o">=</span> <span class="p">[</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">values</span><span class="p">]</span>
        <span class="k">if</span> <span class="kc">False</span> <span class="ow">in</span> <span class="n">strings</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">'All keywords must be strings: </span><span class="si">{</span><span class="n">values</span><span class="si">}</span><span class="s1">'</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">values</span><span class="o">=</span><span class="nb">sorted</span><span class="p">(</span><span class="n">values</span><span class="p">),</span>
                                              <span class="n">target</span><span class="o">=</span><span class="n">target</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">target</span> <span class="ow">and</span> <span class="n">other</span><span class="o">.</span><span class="n">target</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">target</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">target</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">'Targets must match to combine Keywords'</span><span class="p">)</span>
        <span class="n">target</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">target</span> <span class="ow">or</span> <span class="n">other</span><span class="o">.</span><span class="n">target</span>
        <span class="k">return</span> <span class="n">Keywords</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">values</span> <span class="o">+</span> <span class="n">other</span><span class="o">.</span><span class="n">values</span><span class="p">)),</span> <span class="n">target</span><span class="o">=</span><span class="n">target</span><span class="p">)</span>

<div class="viewcode-block" id="Keywords.fuzzy_match"><a class="viewcode-back" href="../../../reference_manual/holoviews.core.html#holoviews.core.io.Keywords.fuzzy_match">[docs]</a>    <span class="k">def</span> <span class="nf">fuzzy_match</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kw</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        Given a string, fuzzy match against the Keyword values,</span>
<span class="sd">        returning a list of close matches.</span>
<span class="sd">        """</span>
        <span class="k">return</span> <span class="n">difflib</span><span class="o">.</span><span class="n">get_close_matches</span><span class="p">(</span><span class="n">kw</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s1">'Keywords(</span><span class="si">{values}</span><span class="s1">, target=</span><span class="si">{target}</span><span class="s1">)'</span>
            <span class="n">info</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">values</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s1">'Keywords(</span><span class="si">{values}</span><span class="s1">)'</span>
            <span class="n">info</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">values</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">msg</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="n">info</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>           <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
    <span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>          <span class="k">return</span> <span class="nb">iter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
    <span class="k">def</span> <span class="fm">__bool__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>          <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">__nonzero__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>       <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
    <span class="k">def</span> <span class="fm">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span> <span class="k">return</span> <span class="n">val</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span></div>



<div class="viewcode-block" id="Cycle"><a class="viewcode-back" href="../../../reference_manual/holoviews.plotting.html#holoviews.core.io.Cycle">[docs]</a><span class="k">class</span> <span class="nc">Cycle</span><span class="p">(</span><span class="n">param</span><span class="o">.</span><span class="n">Parameterized</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    A simple container class that specifies cyclic options. A typical</span>
<span class="sd">    example would be to cycle the curve colors in an Overlay composed</span>
<span class="sd">    of an arbitrary number of curves. The values may be supplied as</span>
<span class="sd">    an explicit list or a key to look up in the default cycles</span>
<span class="sd">    attribute.</span>
<span class="sd">    """</span>

    <span class="n">key</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">String</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="s1">'default_colors'</span><span class="p">,</span> <span class="n">allow_None</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">doc</span><span class="o">=</span><span class="s2">"""</span>
<span class="s2">       The key in the default_cycles dictionary used to specify the</span>
<span class="s2">       color cycle if values is not supplied. """</span><span class="p">)</span>

    <span class="n">values</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">List</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="p">[],</span> <span class="n">doc</span><span class="o">=</span><span class="s2">"""</span>
<span class="s2">       The values the cycle will iterate over."""</span><span class="p">)</span>

    <span class="n">default_cycles</span> <span class="o">=</span> <span class="p">{</span><span class="s1">'default_colors'</span><span class="p">:</span> <span class="p">[]}</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cycle</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">cycle</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cycle</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="n">params</span><span class="p">[</span><span class="s1">'key'</span><span class="p">]</span> <span class="o">=</span> <span class="n">cycle</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">params</span><span class="p">[</span><span class="s1">'values'</span><span class="p">]</span> <span class="o">=</span> <span class="n">cycle</span>
                <span class="n">params</span><span class="p">[</span><span class="s1">'key'</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">params</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values</span><span class="p">()</span>


    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">num</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">(</span><span class="n">values</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">[:</span><span class="n">num</span><span class="p">])</span>


    <span class="k">def</span> <span class="nf">_get_values</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">:</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">default_cycles</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"Supply either a key or explicit values."</span><span class="p">)</span>


    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">):</span>
        <span class="n">values</span> <span class="o">=</span> <span class="n">values</span> <span class="k">if</span> <span class="n">values</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="o">**</span><span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">get_param_values</span><span class="p">(),</span> <span class="n">values</span><span class="o">=</span><span class="n">values</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">))</span>


    <span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>


    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">key</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">objects</span><span class="p">(</span><span class="kc">False</span><span class="p">)[</span><span class="s1">'key'</span><span class="p">]</span><span class="o">.</span><span class="n">default</span><span class="p">:</span>
            <span class="n">vrepr</span> <span class="o">=</span> <span class="s1">''</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">:</span>
            <span class="n">vrepr</span> <span class="o">=</span> <span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">vrepr</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">el</span><span class="p">)</span> <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">]</span>
        <span class="k">return</span> <span class="s2">"</span><span class="si">%s</span><span class="s2">(</span><span class="si">%s</span><span class="s2">)"</span> <span class="o">%</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">vrepr</span><span class="p">)</span></div>



<span class="k">def</span> <span class="nf">grayscale</span><span class="p">(</span><span class="n">val</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>


<div class="viewcode-block" id="Palette"><a class="viewcode-back" href="../../../reference_manual/holoviews.core.html#holoviews.core.io.Palette">[docs]</a><span class="k">class</span> <span class="nc">Palette</span><span class="p">(</span><span class="n">Cycle</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    Palettes allow easy specifying a discrete sampling</span>
<span class="sd">    of an existing colormap. Palettes may be supplied a key</span>
<span class="sd">    to look up a function function in the colormap class</span>
<span class="sd">    attribute. The function should accept a float scalar</span>
<span class="sd">    in the specified range and return a RGB(A) tuple.</span>
<span class="sd">    The number of samples may also be specified as a</span>
<span class="sd">    parameter.</span>

<span class="sd">    The range and samples may conveniently be overridden</span>
<span class="sd">    with the __getitem__ method.</span>
<span class="sd">    """</span>

    <span class="n">key</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">String</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="s1">'grayscale'</span><span class="p">,</span> <span class="n">doc</span><span class="o">=</span><span class="s2">"""</span>
<span class="s2">       Palettes look up the Palette values based on some key."""</span><span class="p">)</span>

    <span class="nb">range</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">NumericTuple</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">doc</span><span class="o">=</span><span class="s2">"""</span>
<span class="s2">        The range from which the Palette values are sampled."""</span><span class="p">)</span>

    <span class="n">samples</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Integer</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mi">32</span><span class="p">,</span> <span class="n">doc</span><span class="o">=</span><span class="s2">"""</span>
<span class="s2">        The number of samples in the given range to supply to</span>
<span class="s2">        the sample_fn."""</span><span class="p">)</span>

    <span class="n">sample_fn</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Callable</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">,</span> <span class="n">doc</span><span class="o">=</span><span class="s2">"""</span>
<span class="s2">        The function to generate the samples, by default linear."""</span><span class="p">)</span>

    <span class="n">reverse</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Boolean</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">doc</span><span class="o">=</span><span class="s2">"""</span>
<span class="s2">        Whether to reverse the palette."""</span><span class="p">)</span>

    <span class="c1"># A list of available colormaps</span>
    <span class="n">colormaps</span> <span class="o">=</span> <span class="p">{</span><span class="s1">'grayscale'</span><span class="p">:</span> <span class="n">grayscale</span><span class="p">}</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Cycle</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="n">key</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values</span><span class="p">()</span>


    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">slc</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        Provides a convenient interface to override the</span>
<span class="sd">        range and samples parameters of the Cycle.</span>
<span class="sd">        Supplying a slice step or index overrides the</span>
<span class="sd">        number of samples. Unsupplied slice values will be</span>
<span class="sd">        inherited.</span>
<span class="sd">        """</span>
        <span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="p">),</span> <span class="n">step</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">range</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">samples</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">slc</span><span class="p">,</span> <span class="nb">slice</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">slc</span><span class="o">.</span><span class="n">start</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">start</span> <span class="o">=</span> <span class="n">slc</span><span class="o">.</span><span class="n">start</span>
            <span class="k">if</span> <span class="n">slc</span><span class="o">.</span><span class="n">stop</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">stop</span> <span class="o">=</span> <span class="n">slc</span><span class="o">.</span><span class="n">stop</span>
            <span class="k">if</span> <span class="n">slc</span><span class="o">.</span><span class="n">step</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">step</span> <span class="o">=</span> <span class="n">slc</span><span class="o">.</span><span class="n">step</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">step</span> <span class="o">=</span> <span class="n">slc</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">(</span><span class="nb">range</span><span class="o">=</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="p">),</span> <span class="n">samples</span><span class="o">=</span><span class="n">step</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">_get_values</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">cmap</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">colormaps</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">]</span>
        <span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="p">),</span> <span class="n">steps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">range</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">samples</span>
        <span class="n">samples</span> <span class="o">=</span> <span class="p">[</span><span class="n">cmap</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sample_fn</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="p">,</span> <span class="n">steps</span><span class="p">)]</span>
        <span class="k">return</span> <span class="n">samples</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">reverse</span> <span class="k">else</span> <span class="n">samples</span></div>



<div class="viewcode-block" id="Options"><a class="viewcode-back" href="../../../reference_manual/holoviews.core.html#holoviews.core.io.Options">[docs]</a><span class="k">class</span> <span class="nc">Options</span><span class="p">:</span>
    <span class="sd">"""</span>
<span class="sd">    An Options object holds a collection of keyword options. In</span>
<span class="sd">    addition, Options support (optional) keyword validation as well as</span>
<span class="sd">    infinite indexing over the set of supplied cyclic values.</span>

<span class="sd">    Options support inheritance of setting values via the __call__</span>
<span class="sd">    method. By calling an Options object with additional keywords, you</span>
<span class="sd">    can create a new Options object inheriting the parent options.</span>
<span class="sd">    """</span>

    <span class="c1"># Whether all Options instances should skip invalid keywords or</span>
    <span class="c1"># raise and exception.</span>
    <span class="n">skip_invalid</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="c1"># Whether all Options instances should generate warnings when</span>
    <span class="c1"># skipping over invalid keywords or not. May only be specified at</span>
    <span class="c1"># the class level.</span>
    <span class="n">warn_on_skip</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="n">_option_groups</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'style'</span><span class="p">,</span> <span class="s1">'plot'</span><span class="p">,</span> <span class="s1">'norm'</span><span class="p">,</span> <span class="s1">'output'</span><span class="p">]</span>

    <span class="n">_output_allowed_kws</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'backend'</span><span class="p">]</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">allowed_keywords</span><span class="o">=</span><span class="p">[],</span> <span class="n">merge_keywords</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                 <span class="n">max_cycles</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>

        <span class="n">invalid_kws</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">kwarg</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="k">if</span> <span class="n">allowed_keywords</span> <span class="ow">and</span> <span class="n">kwarg</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">allowed_keywords</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">skip_invalid</span><span class="p">:</span>
                    <span class="n">invalid_kws</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">kwarg</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">OptionError</span><span class="p">(</span><span class="n">kwarg</span><span class="p">,</span> <span class="n">allowed_keywords</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">key</span> <span class="ow">and</span> <span class="n">key</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">islower</span><span class="p">()</span> <span class="ow">and</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_option_groups</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">'Key </span><span class="si">%s</span><span class="s1"> does not start with a capitalized element class name and is not a group in </span><span class="si">%s</span><span class="s1">'</span>
                            <span class="o">%</span> <span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">key</span><span class="p">),</span> <span class="s1">', '</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">el</span><span class="p">)</span> <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_option_groups</span><span class="p">)))</span>

        <span class="k">for</span> <span class="n">invalid_kw</span> <span class="ow">in</span> <span class="n">invalid_kws</span><span class="p">:</span>
            <span class="n">error</span> <span class="o">=</span> <span class="n">OptionError</span><span class="p">(</span><span class="n">invalid_kw</span><span class="p">,</span> <span class="n">allowed_keywords</span><span class="p">,</span> <span class="n">group_name</span><span class="o">=</span><span class="n">key</span><span class="p">)</span>
            <span class="n">StoreOptions</span><span class="o">.</span><span class="n">record_skipped_option</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">invalid_kws</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">warn_on_skip</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">"Invalid options </span><span class="si">%s</span><span class="s2">, valid options are: </span><span class="si">%s</span><span class="s2">"</span>
                               <span class="o">%</span> <span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">invalid_kws</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">allowed_keywords</span><span class="p">)))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">([(</span><span class="n">k</span><span class="p">,</span><span class="n">kwargs</span><span class="p">[</span><span class="n">k</span><span class="p">])</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">invalid_kws</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_options</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_max_cycles</span> <span class="o">=</span> <span class="n">max_cycles</span>

        <span class="n">allowed_keywords</span> <span class="o">=</span> <span class="p">(</span><span class="n">allowed_keywords</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">allowed_keywords</span><span class="p">,</span> <span class="n">Keywords</span><span class="p">)</span>
                            <span class="k">else</span> <span class="n">Keywords</span><span class="p">(</span><span class="n">allowed_keywords</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">allowed_keywords</span> <span class="o">=</span> <span class="n">allowed_keywords</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">merge_keywords</span> <span class="o">=</span> <span class="n">merge_keywords</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">key</span> <span class="o">=</span> <span class="n">key</span>

<div class="viewcode-block" id="Options.keywords_target"><a class="viewcode-back" href="../../../reference_manual/holoviews.core.html#holoviews.core.io.Options.keywords_target">[docs]</a>    <span class="k">def</span> <span class="nf">keywords_target</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        Helper method to easily set the target on the allowed_keywords Keywords.</span>
<span class="sd">        """</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">allowed_keywords</span><span class="o">.</span><span class="n">target</span> <span class="o">=</span> <span class="n">target</span>
        <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="Options.filtered"><a class="viewcode-back" href="../../../reference_manual/holoviews.core.html#holoviews.core.io.Options.filtered">[docs]</a>    <span class="k">def</span> <span class="nf">filtered</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">allowed</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        Return a new Options object that is filtered by the specified</span>
<span class="sd">        list of keys. Mutating self.kwargs to filter is unsafe due to</span>
<span class="sd">        the option expansion that occurs on initialization.</span>
<span class="sd">        """</span>
        <span class="n">kws</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span><span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">allowed</span><span class="p">}</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">,</span>
                              <span class="n">allowed_keywords</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">allowed_keywords</span><span class="p">,</span>
                              <span class="n">merge_keywords</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">merge_keywords</span><span class="p">,</span> <span class="o">**</span><span class="n">kws</span><span class="p">)</span></div>


    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">allowed_keywords</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        Create a new Options object that inherits the parent options.</span>
<span class="sd">        """</span>
        <span class="k">if</span> <span class="s1">'key'</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s1">'key'</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">key</span>
        <span class="n">allowed_keywords</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">allowed_keywords</span> <span class="k">if</span> <span class="n">allowed_keywords</span> <span class="ow">in</span> <span class="p">[</span><span class="kc">None</span><span class="p">,[]]</span> <span class="k">else</span> <span class="n">allowed_keywords</span>
        <span class="n">inherited_style</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">allowed_keywords</span><span class="o">=</span><span class="n">allowed_keywords</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="o">**</span><span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">,</span> <span class="o">**</span><span class="n">inherited_style</span><span class="p">))</span>

<div class="viewcode-block" id="Options.keys"><a class="viewcode-back" href="../../../reference_manual/holoviews.core.html#holoviews.core.io.Options.keys">[docs]</a>    <span class="k">def</span> <span class="nf">keys</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s2">"The keyword names across the supplied options."</span>
        <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span></div>

<div class="viewcode-block" id="Options.max_cycles"><a class="viewcode-back" href="../../../reference_manual/holoviews.core.html#holoviews.core.io.Options.max_cycles">[docs]</a>    <span class="k">def</span> <span class="nf">max_cycles</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">num</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        Truncates all contained Palette objects to a maximum number</span>
<span class="sd">        of samples and returns a new Options object containing the</span>
<span class="sd">        truncated or resampled Palettes.</span>
<span class="sd">        """</span>
        <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="n">kw</span><span class="p">:</span> <span class="p">(</span><span class="n">arg</span><span class="p">[</span><span class="n">num</span><span class="p">]</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="n">Palette</span><span class="p">)</span> <span class="k">else</span> <span class="n">arg</span><span class="p">)</span>
                  <span class="k">for</span> <span class="n">kw</span><span class="p">,</span> <span class="n">arg</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">(</span><span class="n">max_cycles</span><span class="o">=</span><span class="n">num</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">cyclic</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s2">"Returns True if the options cycle, otherwise False"</span>
        <span class="k">return</span> <span class="nb">any</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">Cycle</span><span class="p">)</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>

    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        Infinite cyclic indexing of options over the integers,</span>
<span class="sd">        looping over the set of defined Cycle objects.</span>
<span class="sd">        """</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{}</span>

        <span class="n">cycles</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span><span class="n">v</span><span class="o">.</span><span class="n">values</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">Cycle</span><span class="p">)}</span>
        <span class="n">options</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">values</span> <span class="ow">in</span> <span class="n">cycles</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">options</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="n">index</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)]</span>

        <span class="n">static</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span><span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">Cycle</span><span class="p">)}</span>
        <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">static</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">options</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s2">"Access of the options keywords when no cycles are defined."</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">cyclic</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">"The options property may only be used"</span>
                            <span class="s2">" with non-cyclic Options."</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">kws</span> <span class="o">=</span> <span class="s1">', '</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="si">!r}</span><span class="s2">"</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
        <span class="n">cls_name</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">key</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">isupper</span><span class="p">()</span> <span class="ow">and</span> <span class="n">kws</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">cls_name</span><span class="si">}</span><span class="s2">(</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="si">!r}</span><span class="s2">, </span><span class="si">{</span><span class="n">kws</span><span class="si">}</span><span class="s2">)"</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">key</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">isupper</span><span class="p">():</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">cls_name</span><span class="si">}</span><span class="s2">(</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="si">!r}</span><span class="s2">)"</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">cls_name</span><span class="si">}</span><span class="s2">(</span><span class="si">{</span><span class="n">kws</span><span class="si">}</span><span class="s2">)"</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div>



<div class="viewcode-block" id="OptionTree"><a class="viewcode-back" href="../../../reference_manual/holoviews.core.html#holoviews.core.io.OptionTree">[docs]</a><span class="k">class</span> <span class="nc">OptionTree</span><span class="p">(</span><span class="n">AttrTree</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    A subclass of AttrTree that is used to define the inheritance</span>
<span class="sd">    relationships between a collection of Options objects. Each node</span>
<span class="sd">    of the tree supports a group of Options objects and the leaf nodes</span>
<span class="sd">    inherit their keyword values from parent nodes up to the root.</span>

<span class="sd">    Supports the ability to search the tree for the closest valid path</span>
<span class="sd">    using the find method, or compute the appropriate Options value</span>
<span class="sd">    given an object and a mode. For a given node of the tree, the</span>
<span class="sd">    options method computes a Options object containing the result of</span>
<span class="sd">    inheritance for a given group up to the root of the tree.</span>

<span class="sd">    When constructing an OptionTree, you can specify the option groups</span>
<span class="sd">    as a list (i.e. empty initial option groups at the root) or as a</span>
<span class="sd">    dictionary (e.g. groups={'style':Option()}). You can also</span>
<span class="sd">    initialize the OptionTree with the options argument together with</span>
<span class="sd">    the **kwargs - see StoreOptions.merge_options for more information</span>
<span class="sd">    on the options specification syntax.</span>

<span class="sd">    You can use the string specifier '.' to refer to the root node in</span>
<span class="sd">    the options specification. This acts as an alternative was of</span>
<span class="sd">    specifying the options groups of the current node. Note that this</span>
<span class="sd">    approach method may only be used with the group lists format.</span>
<span class="sd">    """</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">items</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">identifier</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">groups</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">backend</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>

        <span class="k">if</span> <span class="n">groups</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">'Please supply groups list or dictionary'</span><span class="p">)</span>
        <span class="n">_groups</span> <span class="o">=</span> <span class="p">{</span><span class="n">g</span><span class="p">:</span><span class="n">Options</span><span class="p">()</span> <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">groups</span><span class="p">}</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">groups</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="k">else</span> <span class="n">groups</span>

        <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="s1">'backend'</span><span class="p">]</span> <span class="o">=</span> <span class="n">backend</span>
        <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="s1">'groups'</span><span class="p">]</span> <span class="o">=</span> <span class="n">_groups</span>
        <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="s1">'_instantiated'</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">AttrTree</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">items</span><span class="p">,</span> <span class="n">identifier</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="s1">'_instantiated'</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="n">options</span> <span class="o">=</span> <span class="n">StoreOptions</span><span class="o">.</span><span class="n">merge_options</span><span class="p">(</span><span class="n">_groups</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="n">options</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">root_groups</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">'.'</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">root_groups</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">groups</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="s1">'groups'</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="n">g</span><span class="p">:</span><span class="n">Options</span><span class="p">(</span><span class="o">**</span><span class="n">root_groups</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">g</span><span class="p">,{}))</span> <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">_groups</span><span class="o">.</span><span class="n">keys</span><span class="p">()}</span>
        <span class="k">elif</span> <span class="n">root_groups</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="s2">"Group specification as a dictionary only supported if "</span>
                <span class="s2">"the root node '.' syntax not used in the options."</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">options</span><span class="p">:</span>
            <span class="n">StoreOptions</span><span class="o">.</span><span class="n">apply_customizations</span><span class="p">(</span><span class="n">options</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_merge_options</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">identifier</span><span class="p">,</span> <span class="n">group_name</span><span class="p">,</span> <span class="n">options</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        Computes a merged Options object for the given group</span>
<span class="sd">        name from the existing Options on the node and the</span>
<span class="sd">        new Options which are passed in.</span>
<span class="sd">        """</span>
        <span class="k">if</span> <span class="n">group_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">groups</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Group </span><span class="si">{</span><span class="n">group_name</span><span class="si">}</span><span class="s2"> not defined on SettingTree."</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">identifier</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
            <span class="n">current_node</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="n">identifier</span><span class="p">]</span>
            <span class="n">group_options</span> <span class="o">=</span> <span class="n">current_node</span><span class="o">.</span><span class="n">groups</span><span class="p">[</span><span class="n">group_name</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># When creating a node (nothing to merge with) ensure it is empty</span>
            <span class="n">group_options</span> <span class="o">=</span> <span class="n">Options</span><span class="p">(</span>
                <span class="n">group_name</span><span class="p">,</span> <span class="n">allowed_keywords</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">groups</span><span class="p">[</span><span class="n">group_name</span><span class="p">]</span><span class="o">.</span><span class="n">allowed_keywords</span>
            <span class="p">)</span>

        <span class="n">override_kwargs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">old_allowed</span> <span class="o">=</span> <span class="n">group_options</span><span class="o">.</span><span class="n">allowed_keywords</span>
        <span class="n">override_kwargs</span><span class="p">[</span><span class="s1">'allowed_keywords'</span><span class="p">]</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">allowed_keywords</span> <span class="o">+</span> <span class="n">old_allowed</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">merge_keywords</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">group_options</span><span class="p">(</span><span class="o">**</span><span class="n">override_kwargs</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">Options</span><span class="p">(</span><span class="n">group_name</span><span class="p">,</span> <span class="o">**</span><span class="n">override_kwargs</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">OptionError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">OptionError</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">invalid_keyword</span><span class="p">,</span>
                              <span class="n">e</span><span class="o">.</span><span class="n">allowed_keywords</span><span class="p">,</span>
                              <span class="n">group_name</span><span class="o">=</span><span class="n">group_name</span><span class="p">,</span>
                              <span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">groups</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">groups</span><span class="p">[</span><span class="n">item</span><span class="p">]</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__getitem__</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">identifier</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        Allows creating sub OptionTree instances using attribute</span>
<span class="sd">        access, inheriting the group options.</span>
<span class="sd">        """</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">AttrTree</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__getattr__</span><span class="p">(</span><span class="n">identifier</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="k">if</span> <span class="n">identifier</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">'_'</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">identifier</span><span class="p">))</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">fixed</span><span class="o">==</span><span class="kc">True</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_fixed_error</span> <span class="o">%</span> <span class="n">identifier</span><span class="p">)</span>

        <span class="n">valid_id</span> <span class="o">=</span> <span class="n">sanitize_identifier</span><span class="p">(</span><span class="n">identifier</span><span class="p">,</span> <span class="n">escape</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">valid_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">valid_id</span><span class="p">]</span>

        <span class="c1"># When creating a intermediate child node, leave kwargs empty</span>
        <span class="bp">self</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="n">identifier</span><span class="p">,</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span><span class="n">Options</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">allowed_keywords</span><span class="o">=</span><span class="n">v</span><span class="o">.</span><span class="n">allowed_keywords</span><span class="p">)</span>
                                      <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">groups</span><span class="o">.</span><span class="n">items</span><span class="p">()})</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">[</span><span class="n">identifier</span><span class="p">]</span>


    <span class="k">def</span> <span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">identifier</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="c1"># Invalidate the lookup cache whenever an option is changed</span>
        <span class="n">Store</span><span class="o">.</span><span class="n">_lookup_cache</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">backend</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="n">identifier</span> <span class="o">=</span> <span class="n">sanitize_identifier</span><span class="p">(</span><span class="n">identifier</span><span class="p">,</span> <span class="n">escape</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">new_groups</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="n">group_items</span> <span class="o">=</span> <span class="n">val</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">Options</span><span class="p">)</span> <span class="ow">and</span> <span class="n">val</span><span class="o">.</span><span class="n">key</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span>
                <span class="s2">"Options object needs to have a group name specified."</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">Options</span><span class="p">)</span> <span class="ow">and</span> <span class="n">val</span><span class="o">.</span><span class="n">key</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">isupper</span><span class="p">():</span>
            <span class="n">groups</span> <span class="o">=</span> <span class="s1">', '</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">el</span><span class="p">)</span> <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="n">Options</span><span class="o">.</span><span class="n">_option_groups</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">"OptionTree only accepts Options using keys that are one of </span><span class="si">{</span><span class="n">groups</span><span class="si">}</span><span class="s2">."</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">Options</span><span class="p">):</span>
            <span class="n">group_items</span> <span class="o">=</span> <span class="p">{</span><span class="n">val</span><span class="o">.</span><span class="n">key</span><span class="p">:</span> <span class="n">val</span><span class="p">}</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">OptionTree</span><span class="p">):</span>
            <span class="n">group_items</span> <span class="o">=</span> <span class="n">val</span><span class="o">.</span><span class="n">groups</span>

        <span class="n">current_node</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="n">identifier</span><span class="p">]</span> <span class="k">if</span> <span class="n">identifier</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">children</span> <span class="k">else</span> <span class="bp">self</span>
        <span class="k">for</span> <span class="n">group_name</span> <span class="ow">in</span> <span class="n">current_node</span><span class="o">.</span><span class="n">groups</span><span class="p">:</span>
            <span class="n">options</span> <span class="o">=</span> <span class="n">group_items</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">group_name</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">options</span><span class="p">:</span>
                <span class="n">new_groups</span><span class="p">[</span><span class="n">group_name</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_merge_options</span><span class="p">(</span><span class="n">identifier</span><span class="p">,</span> <span class="n">group_name</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">new_groups</span><span class="p">[</span><span class="n">group_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">current_node</span><span class="o">.</span><span class="n">groups</span><span class="p">[</span><span class="n">group_name</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">new_groups</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="n">identifier</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">identifier</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">children</span> <span class="k">else</span> <span class="kc">None</span>
            <span class="n">new_node</span> <span class="o">=</span> <span class="n">OptionTree</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">identifier</span><span class="o">=</span><span class="n">identifier</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">groups</span><span class="o">=</span><span class="n">new_groups</span><span class="p">,</span> <span class="n">backend</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">backend</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">'OptionTree only accepts a dictionary of Options.'</span><span class="p">)</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="n">identifier</span><span class="p">,</span> <span class="n">new_node</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">OptionTree</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">subtree</span> <span class="ow">in</span> <span class="n">val</span><span class="p">:</span>
                <span class="bp">self</span><span class="p">[</span><span class="n">identifier</span><span class="p">]</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="n">subtree</span><span class="o">.</span><span class="n">identifier</span><span class="p">,</span> <span class="n">subtree</span><span class="p">)</span>

<div class="viewcode-block" id="OptionTree.find"><a class="viewcode-back" href="../../../reference_manual/holoviews.core.html#holoviews.core.io.OptionTree.find">[docs]</a>    <span class="k">def</span> <span class="nf">find</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">'node'</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        Find the closest node or path to an the arbitrary path that is</span>
<span class="sd">        supplied down the tree from the given node. The mode argument</span>
<span class="sd">        may be either 'node' or 'path' which determines the return</span>
<span class="sd">        type.</span>
<span class="sd">        """</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">'.'</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">else</span> <span class="nb">list</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="n">item</span> <span class="o">=</span> <span class="bp">self</span>

        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">path</span><span class="p">:</span>
            <span class="n">escaped_child</span> <span class="o">=</span> <span class="n">sanitize_identifier</span><span class="p">(</span><span class="n">child</span><span class="p">,</span> <span class="n">escape</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">matching_children</span> <span class="o">=</span> <span class="p">(</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">item</span><span class="o">.</span><span class="n">children</span>
                                 <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="ow">or</span> <span class="n">escaped_child</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="n">c</span><span class="p">))</span>
            <span class="n">matching_children</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">matching_children</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">matching_children</span><span class="p">:</span>
                <span class="n">item</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="n">matching_children</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">continue</span>
        <span class="k">return</span> <span class="n">item</span> <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s1">'node'</span> <span class="k">else</span> <span class="n">item</span><span class="o">.</span><span class="n">path</span></div>

<div class="viewcode-block" id="OptionTree.closest"><a class="viewcode-back" href="../../../reference_manual/holoviews.core.html#holoviews.core.io.OptionTree.closest">[docs]</a>    <span class="k">def</span> <span class="nf">closest</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">group</span><span class="p">,</span> <span class="n">defaults</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">backend</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        This method is designed to be called from the root of the</span>
<span class="sd">        tree. Given any LabelledData object, this method will return</span>
<span class="sd">        the most appropriate Options object, including inheritance.</span>

<span class="sd">        In addition, closest supports custom options by checking the</span>
<span class="sd">        object</span>
<span class="sd">        """</span>
        <span class="n">opts_spec</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">obj</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
            <span class="n">group_sanitizer</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">group</span><span class="p">),</span>
            <span class="n">label_sanitizer</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">label</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="c1"># Try to get a cache hit in the backend lookup cache</span>
        <span class="n">backend</span> <span class="o">=</span> <span class="n">backend</span> <span class="ow">or</span> <span class="n">Store</span><span class="o">.</span><span class="n">current_backend</span>
        <span class="n">cache</span> <span class="o">=</span> <span class="n">Store</span><span class="o">.</span><span class="n">_lookup_cache</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">backend</span><span class="p">,</span> <span class="p">{})</span>
        <span class="n">cache_key</span> <span class="o">=</span> <span class="n">opts_spec</span><span class="o">+</span><span class="p">(</span><span class="n">group</span><span class="p">,</span> <span class="n">defaults</span><span class="p">,</span> <span class="nb">id</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">cache_key</span> <span class="ow">in</span> <span class="n">cache</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">cache</span><span class="p">[</span><span class="n">cache_key</span><span class="p">]</span>

        <span class="n">target</span> <span class="o">=</span> <span class="s1">'.'</span><span class="o">.</span><span class="n">join</span><span class="p">((</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">opts_spec</span> <span class="k">if</span> <span class="n">c</span><span class="p">))</span>
        <span class="n">options</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">opts_spec</span><span class="p">)</span><span class="o">.</span><span class="n">options</span><span class="p">(</span>
            <span class="n">group</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="n">target</span><span class="p">,</span> <span class="n">defaults</span><span class="o">=</span><span class="n">defaults</span><span class="p">,</span> <span class="n">backend</span><span class="o">=</span><span class="n">backend</span><span class="p">)</span>
        <span class="n">cache</span><span class="p">[</span><span class="n">cache_key</span><span class="p">]</span> <span class="o">=</span> <span class="n">options</span>
        <span class="k">return</span> <span class="n">options</span></div>

<div class="viewcode-block" id="OptionTree.options"><a class="viewcode-back" href="../../../reference_manual/holoviews.core.html#holoviews.core.io.OptionTree.options">[docs]</a>    <span class="k">def</span> <span class="nf">options</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">group</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">defaults</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">backend</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        Using inheritance up to the root, get the complete Options</span>
<span class="sd">        object for the given node and the specified group.</span>
<span class="sd">        """</span>
        <span class="k">if</span> <span class="n">target</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">target</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">groups</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">group</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="n">options</span> <span class="o">=</span> <span class="n">Store</span><span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="n">backend</span><span class="o">=</span><span class="n">backend</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">target</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">options</span><span class="p">)</span> <span class="ow">and</span> <span class="n">defaults</span><span class="p">:</span>
            <span class="n">root_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span>
            <span class="n">replacement</span> <span class="o">=</span> <span class="n">root_name</span> <span class="o">+</span> <span class="p">(</span><span class="s1">''</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">target</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">root_name</span><span class="p">)</span> <span class="k">else</span> <span class="s1">'.'</span><span class="p">)</span>
            <span class="n">option_key</span> <span class="o">=</span> <span class="n">target</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">replacement</span><span class="p">,</span> <span class="s1">''</span><span class="p">)</span>
            <span class="n">match</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">option_key</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">match</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">options</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">match</span><span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="n">group</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">EMPTY_OPTIONS</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">groups</span><span class="p">[</span><span class="n">group</span><span class="p">]</span>

        <span class="n">parent_opts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="n">group</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">defaults</span><span class="p">,</span> <span class="n">backend</span><span class="o">=</span><span class="n">backend</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Options</span><span class="p">(</span><span class="o">**</span><span class="nb">dict</span><span class="p">(</span><span class="n">parent_opts</span><span class="o">.</span><span class="n">kwargs</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">groups</span><span class="p">[</span><span class="n">group</span><span class="p">]</span><span class="o">.</span><span class="n">kwargs</span><span class="p">))</span></div>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        Evalable representation of the OptionTree.</span>
<span class="sd">        """</span>
        <span class="n">groups</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="s1">'groups'</span><span class="p">]</span>
        <span class="c1"># Tab and group entry separators</span>
        <span class="n">tab</span><span class="p">,</span> <span class="n">gsep</span> <span class="o">=</span> <span class="s1">'   '</span><span class="p">,</span> <span class="s1">',</span><span class="se">\n\n</span><span class="s1">'</span>
        <span class="c1"># Entry separator and group specifications</span>
        <span class="n">esep</span><span class="p">,</span> <span class="n">gspecs</span> <span class="o">=</span> <span class="p">(</span><span class="s2">",</span><span class="se">\n</span><span class="s2">"</span><span class="o">+</span><span class="p">(</span><span class="n">tab</span><span class="o">*</span><span class="mi">2</span><span class="p">)),</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">groups</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">especs</span><span class="p">,</span> <span class="n">accumulator</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
            <span class="k">if</span> <span class="n">groups</span><span class="p">[</span><span class="n">group</span><span class="p">]</span><span class="o">.</span><span class="n">kwargs</span> <span class="o">!=</span> <span class="p">{}:</span>
                <span class="n">accumulator</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">'.'</span><span class="p">,</span> <span class="n">groups</span><span class="p">[</span><span class="n">group</span><span class="p">]</span><span class="o">.</span><span class="n">kwargs</span><span class="p">))</span>

            <span class="k">for</span> <span class="n">t</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
                <span class="n">kwargs</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">groups</span><span class="p">[</span><span class="n">group</span><span class="p">]</span><span class="o">.</span><span class="n">kwargs</span>
                <span class="n">accumulator</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">'.'</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">t</span><span class="p">),</span> <span class="n">kwargs</span><span class="p">))</span>

            <span class="k">for</span> <span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">kws</span><span class="p">)</span> <span class="ow">in</span> <span class="n">accumulator</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">group</span><span class="o">==</span><span class="s1">'norm'</span> <span class="ow">and</span> <span class="nb">all</span><span class="p">(</span><span class="n">kws</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">False</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">'axiswise'</span><span class="p">,</span><span class="s1">'framewise'</span><span class="p">]):</span>
                    <span class="k">continue</span>
                <span class="k">elif</span> <span class="n">kws</span><span class="p">:</span>
                    <span class="n">especs</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">t</span><span class="p">,</span> <span class="n">kws</span><span class="p">))</span>

            <span class="k">if</span> <span class="n">especs</span><span class="p">:</span>
                <span class="n">format_kws</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="s1">'dict(</span><span class="si">%s</span><span class="s1">)'</span> <span class="o">%</span> <span class="s1">', '</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="sa">f</span><span class="s1">'</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s1">=</span><span class="si">{</span><span class="n">v</span><span class="si">}</span><span class="s1">'</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">kws</span><span class="o">.</span><span class="n">items</span><span class="p">())))</span>
                    <span class="k">for</span> <span class="n">t</span><span class="p">,</span> <span class="n">kws</span> <span class="ow">in</span> <span class="n">especs</span>
                <span class="p">]</span>
                <span class="n">ljust</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="k">for</span> <span class="n">t</span><span class="p">,</span><span class="n">_</span> <span class="ow">in</span> <span class="n">format_kws</span><span class="p">)</span>
                <span class="n">sep</span> <span class="o">=</span> <span class="p">(</span><span class="n">tab</span><span class="o">*</span><span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">format_kws</span><span class="p">)</span> <span class="o">&gt;</span><span class="mi">1</span> <span class="k">else</span> <span class="s1">''</span>
                <span class="n">entries</span> <span class="o">=</span> <span class="n">sep</span> <span class="o">+</span> <span class="n">esep</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="sa">f</span><span class="s1">'</span><span class="si">{</span><span class="n">sep</span><span class="si">}{</span><span class="n">t</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="n">ljust</span><span class="p">)</span><span class="si">}</span><span class="s1"> : </span><span class="si">{</span><span class="n">v</span><span class="si">}</span><span class="s1">'</span> <span class="k">for</span> <span class="n">t</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">format_kws</span><span class="p">])</span>
                <span class="n">gspecs</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">'</span><span class="si">%s%s</span><span class="s1">={</span><span class="se">\n</span><span class="si">%s</span><span class="s1">}'</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">format_kws</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">1</span> <span class="k">else</span> <span class="s1">'</span><span class="si">%s%s</span><span class="s1">={</span><span class="si">%s</span><span class="s1">}'</span><span class="p">)</span> <span class="o">%</span> <span class="p">(</span><span class="n">tab</span><span class="p">,</span> <span class="n">group</span><span class="p">,</span> <span class="n">entries</span><span class="p">))</span>

        <span class="k">return</span> <span class="sa">f</span><span class="s1">'OptionTree(groups=</span><span class="si">{</span><span class="n">groups</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span><span class="si">}</span><span class="s1">,</span><span class="se">\n</span><span class="si">{</span><span class="n">gsep</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">gspecs</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="s1">)'</span></div>


<span class="n">EMPTY_OPTIONS</span> <span class="o">=</span> <span class="n">Options</span><span class="p">()</span>


<div class="viewcode-block" id="Compositor"><a class="viewcode-back" href="../../../reference_manual/holoviews.operation.html#holoviews.core.io.Compositor">[docs]</a><span class="k">class</span> <span class="nc">Compositor</span><span class="p">(</span><span class="n">param</span><span class="o">.</span><span class="n">Parameterized</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    A Compositor is a way of specifying an operation to be automatically</span>
<span class="sd">    applied to Overlays that match a specified pattern upon display.</span>

<span class="sd">    Any Operation that takes an Overlay as input may be used to define a</span>
<span class="sd">    compositor.</span>

<span class="sd">    For instance, a compositor may be defined to automatically display</span>
<span class="sd">    three overlaid monochrome matrices as an RGB image as long as the</span>
<span class="sd">    values names of those matrices match 'R', 'G' and 'B'.</span>
<span class="sd">    """</span>

    <span class="n">mode</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">ObjectSelector</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="s1">'data'</span><span class="p">,</span>
                                <span class="n">objects</span><span class="o">=</span><span class="p">[</span><span class="s1">'data'</span><span class="p">,</span> <span class="s1">'display'</span><span class="p">],</span> <span class="n">doc</span><span class="o">=</span><span class="s2">"""</span>
<span class="s2">      The mode of the Compositor object which may be either 'data' or</span>
<span class="s2">      'display'."""</span><span class="p">)</span>

    <span class="n">backends</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">List</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="p">[],</span> <span class="n">doc</span><span class="o">=</span><span class="s2">"""</span>
<span class="s2">      Defines which backends to apply the Compositor for."""</span><span class="p">)</span>

    <span class="n">operation</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Parameter</span><span class="p">(</span><span class="n">doc</span><span class="o">=</span><span class="s2">"""</span>
<span class="s2">       The Operation to apply when collapsing overlays."""</span><span class="p">)</span>

    <span class="n">pattern</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">String</span><span class="p">(</span><span class="n">doc</span><span class="o">=</span><span class="s2">"""</span>
<span class="s2">       The overlay pattern to be processed. An overlay pattern is a</span>
<span class="s2">       sequence of elements specified by dotted paths separated by * .</span>

<span class="s2">       For instance the following pattern specifies three overlayed</span>
<span class="s2">       matrices with values of 'RedChannel', 'GreenChannel' and</span>
<span class="s2">       'BlueChannel' respectively:</span>

<span class="s2">      'Image.RedChannel * Image.GreenChannel * Image.BlueChannel.</span>

<span class="s2">      This pattern specification could then be associated with the RGB</span>
<span class="s2">      operation that returns a single RGB matrix for display."""</span><span class="p">)</span>

    <span class="n">group</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">String</span><span class="p">(</span><span class="n">allow_None</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">doc</span><span class="o">=</span><span class="s2">"""</span>
<span class="s2">       The group identifier for the output of this particular compositor"""</span><span class="p">)</span>

    <span class="n">kwargs</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Dict</span><span class="p">(</span><span class="n">doc</span><span class="o">=</span><span class="s2">"""</span>
<span class="s2">       Optional set of parameters to pass to the operation."""</span><span class="p">)</span>

    <span class="n">transfer_options</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Boolean</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">doc</span><span class="o">=</span><span class="s2">"""</span>
<span class="s2">       Whether to transfer the options from the input to the output."""</span><span class="p">)</span>

    <span class="n">transfer_parameters</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Boolean</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">doc</span><span class="o">=</span><span class="s2">"""</span>
<span class="s2">       Whether to transfer plot options which match to the operation."""</span><span class="p">)</span>

    <span class="n">operations</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># The operations that can be used to define compositors.</span>
    <span class="n">definitions</span> <span class="o">=</span> <span class="p">[]</span> <span class="c1"># The set of all the compositor instances</span>

<div class="viewcode-block" id="Compositor.strongest_match"><a class="viewcode-back" href="../../../reference_manual/holoviews.operation.html#holoviews.core.io.Compositor.strongest_match">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">strongest_match</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">overlay</span><span class="p">,</span> <span class="n">mode</span><span class="p">,</span> <span class="n">backend</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        Returns the single strongest matching compositor operation</span>
<span class="sd">        given an overlay. If no matches are found, None is returned.</span>

<span class="sd">        The best match is defined as the compositor operation with the</span>
<span class="sd">        highest match value as returned by the match_level method.</span>
<span class="sd">        """</span>
        <span class="n">match_strength</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span><span class="n">op</span><span class="o">.</span><span class="n">match_level</span><span class="p">(</span><span class="n">overlay</span><span class="p">),</span> <span class="n">op</span><span class="p">)</span> <span class="k">for</span> <span class="n">op</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">definitions</span>
            <span class="k">if</span> <span class="n">op</span><span class="o">.</span><span class="n">mode</span> <span class="o">==</span> <span class="n">mode</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="n">op</span><span class="o">.</span><span class="n">backends</span> <span class="ow">or</span> <span class="n">backend</span> <span class="ow">in</span> <span class="n">op</span><span class="o">.</span><span class="n">backends</span><span class="p">)</span>
        <span class="p">]</span>
        <span class="n">matches</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span><span class="n">match</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">op</span><span class="p">,</span> <span class="n">match</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="k">for</span> <span class="p">(</span><span class="n">match</span><span class="p">,</span> <span class="n">op</span><span class="p">)</span> <span class="ow">in</span> <span class="n">match_strength</span>
            <span class="k">if</span> <span class="n">match</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="p">]</span>
        <span class="k">if</span> <span class="n">matches</span> <span class="o">==</span> <span class="p">[]:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">matches</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span></div>

<div class="viewcode-block" id="Compositor.collapse_element"><a class="viewcode-back" href="../../../reference_manual/holoviews.operation.html#holoviews.core.io.Compositor.collapse_element">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">collapse_element</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">overlay</span><span class="p">,</span> <span class="n">ranges</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">'data'</span><span class="p">,</span> <span class="n">backend</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        Finds any applicable compositor and applies it.</span>
<span class="sd">        """</span>
        <span class="kn">from</span> <span class="nn">.element</span> <span class="kn">import</span> <span class="n">Element</span>
        <span class="kn">from</span> <span class="nn">.overlay</span> <span class="kn">import</span> <span class="n">Overlay</span><span class="p">,</span> <span class="n">CompositeOverlay</span>
        <span class="n">unpack</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">overlay</span><span class="p">,</span> <span class="n">CompositeOverlay</span><span class="p">):</span>
            <span class="n">overlay</span> <span class="o">=</span> <span class="n">Overlay</span><span class="p">([</span><span class="n">overlay</span><span class="p">])</span>
            <span class="n">unpack</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="n">prev_ids</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">()</span>
        <span class="n">processed</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">match</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">strongest_match</span><span class="p">(</span><span class="n">overlay</span><span class="p">,</span> <span class="n">mode</span><span class="p">,</span> <span class="n">backend</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">match</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">unpack</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">overlay</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">overlay</span><span class="o">.</span><span class="n">values</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">return</span> <span class="n">overlay</span>
            <span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">applicable_op</span><span class="p">,</span> <span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="p">))</span> <span class="o">=</span> <span class="n">match</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">overlay</span><span class="p">,</span> <span class="n">Overlay</span><span class="p">):</span>
                <span class="n">values</span> <span class="o">=</span> <span class="n">overlay</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
                <span class="n">sliced</span> <span class="o">=</span> <span class="n">Overlay</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">stop</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">values</span> <span class="o">=</span> <span class="n">overlay</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                <span class="n">sliced</span> <span class="o">=</span> <span class="n">overlay</span><span class="o">.</span><span class="n">clone</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">stop</span><span class="p">])</span>
            <span class="n">items</span> <span class="o">=</span> <span class="n">sliced</span><span class="o">.</span><span class="n">traverse</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">,</span> <span class="p">[</span><span class="n">Element</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">applicable_op</span> <span class="ow">and</span> <span class="nb">all</span><span class="p">(</span><span class="n">el</span> <span class="ow">in</span> <span class="n">processed</span><span class="p">[</span><span class="n">applicable_op</span><span class="p">]</span> <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="n">items</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">unpack</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">overlay</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">overlay</span><span class="o">.</span><span class="n">values</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">return</span> <span class="n">overlay</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">applicable_op</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">sliced</span><span class="p">,</span> <span class="n">ranges</span><span class="p">,</span> <span class="n">backend</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">applicable_op</span><span class="o">.</span><span class="n">group</span><span class="p">:</span>
                <span class="n">result</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">relabel</span><span class="p">(</span><span class="n">group</span><span class="o">=</span><span class="n">applicable_op</span><span class="o">.</span><span class="n">group</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">overlay</span><span class="p">,</span> <span class="n">Overlay</span><span class="p">):</span>
                <span class="n">result</span> <span class="o">=</span> <span class="p">[</span><span class="n">result</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">result</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">sliced</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="p">[</span><span class="n">result</span><span class="p">]))</span>
            <span class="n">processed</span><span class="p">[</span><span class="n">applicable_op</span><span class="p">]</span> <span class="o">+=</span> <span class="p">[</span><span class="n">el</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">result</span> <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="n">r</span><span class="o">.</span><span class="n">traverse</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">,</span> <span class="p">[</span><span class="n">Element</span><span class="p">])]</span>
            <span class="n">overlay</span> <span class="o">=</span> <span class="n">overlay</span><span class="o">.</span><span class="n">clone</span><span class="p">(</span><span class="n">values</span><span class="p">[:</span><span class="n">start</span><span class="p">]</span><span class="o">+</span><span class="n">result</span><span class="o">+</span><span class="n">values</span><span class="p">[</span><span class="n">stop</span><span class="p">:])</span>

            <span class="c1"># Guard against infinite recursion for no-ops</span>
            <span class="n">spec_fn</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">CompositeOverlay</span><span class="p">)</span>
            <span class="n">new_ids</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">overlay</span><span class="o">.</span><span class="n">traverse</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">id</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="p">[</span><span class="n">spec_fn</span><span class="p">]))</span>
            <span class="k">if</span> <span class="n">new_ids</span> <span class="o">==</span> <span class="n">prev_ids</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">overlay</span>
            <span class="n">prev_ids</span> <span class="o">=</span> <span class="n">new_ids</span></div>

<div class="viewcode-block" id="Compositor.collapse"><a class="viewcode-back" href="../../../reference_manual/holoviews.operation.html#holoviews.core.io.Compositor.collapse">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">collapse</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">holomap</span><span class="p">,</span> <span class="n">ranges</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">'data'</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        Given a map of Overlays, apply all applicable compositors.</span>
<span class="sd">        """</span>
        <span class="c1"># No potential compositors</span>
        <span class="k">if</span> <span class="bp">cls</span><span class="o">.</span><span class="n">definitions</span> <span class="o">==</span> <span class="p">[]:</span>
            <span class="k">return</span> <span class="n">holomap</span>

        <span class="c1"># Apply compositors</span>
        <span class="n">clone</span> <span class="o">=</span> <span class="n">holomap</span><span class="o">.</span><span class="n">clone</span><span class="p">(</span><span class="n">shared_data</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="n">ranges</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">holomap</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">values</span><span class="p">())</span> <span class="k">if</span> <span class="n">ranges</span> <span class="k">else</span> <span class="n">holomap</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">overlay</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
            <span class="n">clone</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">collapse_element</span><span class="p">(</span><span class="n">overlay</span><span class="p">,</span> <span class="n">ranges</span><span class="p">,</span> <span class="n">mode</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">clone</span></div>

<div class="viewcode-block" id="Compositor.map"><a class="viewcode-back" href="../../../reference_manual/holoviews.operation.html#holoviews.core.io.Compositor.map">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">map</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">'data'</span><span class="p">,</span> <span class="n">backend</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        Applies compositor operations to any HoloViews element or container</span>
<span class="sd">        using the map method.</span>
<span class="sd">        """</span>
        <span class="kn">from</span> <span class="nn">.overlay</span> <span class="kn">import</span> <span class="n">CompositeOverlay</span>
        <span class="n">element_compositors</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">definitions</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">_pattern_spec</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span>
        <span class="n">overlay_compositors</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">definitions</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">_pattern_spec</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">overlay_compositors</span><span class="p">:</span>
            <span class="n">obj</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">obj</span><span class="p">:</span> <span class="bp">cls</span><span class="o">.</span><span class="n">collapse_element</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">,</span> <span class="n">backend</span><span class="o">=</span><span class="n">backend</span><span class="p">),</span>
                          <span class="p">[</span><span class="n">CompositeOverlay</span><span class="p">])</span>
        <span class="n">element_patterns</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span><span class="o">.</span><span class="n">pattern</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">element_compositors</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">element_compositors</span> <span class="ow">and</span> <span class="n">obj</span><span class="o">.</span><span class="n">traverse</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">,</span> <span class="n">element_patterns</span><span class="p">):</span>
            <span class="n">obj</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">obj</span><span class="p">:</span> <span class="bp">cls</span><span class="o">.</span><span class="n">collapse_element</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">,</span> <span class="n">backend</span><span class="o">=</span><span class="n">backend</span><span class="p">),</span>
                          <span class="n">element_patterns</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">obj</span></div>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">register</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">compositor</span><span class="p">):</span>
        <span class="n">defined_patterns</span> <span class="o">=</span> <span class="p">[</span><span class="n">op</span><span class="o">.</span><span class="n">pattern</span> <span class="k">for</span> <span class="n">op</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">definitions</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">compositor</span><span class="o">.</span><span class="n">pattern</span> <span class="ow">in</span> <span class="n">defined_patterns</span><span class="p">:</span>
            <span class="bp">cls</span><span class="o">.</span><span class="n">definitions</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">defined_patterns</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">compositor</span><span class="o">.</span><span class="n">pattern</span><span class="p">))</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">definitions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">compositor</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">compositor</span><span class="o">.</span><span class="n">operation</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">operations</span><span class="p">:</span>
            <span class="bp">cls</span><span class="o">.</span><span class="n">operations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">compositor</span><span class="o">.</span><span class="n">operation</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pattern</span><span class="p">,</span> <span class="n">operation</span><span class="p">,</span> <span class="n">group</span><span class="p">,</span> <span class="n">mode</span><span class="p">,</span> <span class="n">transfer_options</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                 <span class="n">transfer_parameters</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">output_type</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">backends</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_pattern_spec</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">pattern</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">'*'</span><span class="p">):</span>
            <span class="n">path_tuple</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">el</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="n">path</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">'.'</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_pattern_spec</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">path_tuple</span><span class="p">)</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">path_tuple</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                <span class="n">labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">path_tuple</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="n">l</span><span class="o">==</span><span class="n">labels</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">labels</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s2">"Mismatched labels not allowed in compositor patterns"</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="n">labels</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="s1">''</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_output_type</span> <span class="o">=</span> <span class="n">output_type</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">group</span><span class="o">=</span><span class="n">group</span><span class="p">,</span>
                         <span class="n">pattern</span><span class="o">=</span><span class="n">pattern</span><span class="p">,</span>
                         <span class="n">operation</span><span class="o">=</span><span class="n">operation</span><span class="p">,</span>
                         <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">,</span>
                         <span class="n">backends</span><span class="o">=</span><span class="n">backends</span> <span class="ow">or</span> <span class="p">[],</span>
                         <span class="n">kwargs</span><span class="o">=</span><span class="n">kwargs</span><span class="p">,</span>
                         <span class="n">transfer_options</span><span class="o">=</span><span class="n">transfer_options</span><span class="p">,</span>
                         <span class="n">transfer_parameters</span><span class="o">=</span><span class="n">transfer_parameters</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">output_type</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        Returns the operation output_type unless explicitly overridden</span>
<span class="sd">        in the kwargs.</span>
<span class="sd">        """</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_output_type</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">operation</span><span class="o">.</span><span class="n">output_type</span>

    <span class="k">def</span> <span class="nf">_slice_match_level</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">overlay_items</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        Find the match strength for a list of overlay items that must</span>
<span class="sd">        be exactly the same length as the pattern specification.</span>
<span class="sd">        """</span>
        <span class="n">level</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">spec</span><span class="p">,</span> <span class="n">el</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_pattern_spec</span><span class="p">,</span> <span class="n">overlay_items</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">spec</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="nb">type</span><span class="p">(</span><span class="n">el</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">None</span>
            <span class="n">level</span> <span class="o">+=</span> <span class="mi">1</span>      <span class="c1"># Types match</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">spec</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span> <span class="k">continue</span>

            <span class="n">group</span> <span class="o">=</span> <span class="p">[</span><span class="n">el</span><span class="o">.</span><span class="n">group</span><span class="p">,</span> <span class="n">group_sanitizer</span><span class="p">(</span><span class="n">el</span><span class="o">.</span><span class="n">group</span><span class="p">,</span> <span class="n">escape</span><span class="o">=</span><span class="kc">False</span><span class="p">)]</span>
            <span class="k">if</span> <span class="n">spec</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="n">group</span><span class="p">:</span> <span class="n">level</span> <span class="o">+=</span> <span class="mi">1</span>  <span class="c1"># Values match</span>
            <span class="k">else</span><span class="p">:</span>                     <span class="k">return</span> <span class="kc">None</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">spec</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                <span class="n">group</span> <span class="o">=</span> <span class="p">[</span><span class="n">el</span><span class="o">.</span><span class="n">label</span><span class="p">,</span> <span class="n">label_sanitizer</span><span class="p">(</span><span class="n">el</span><span class="o">.</span><span class="n">label</span><span class="p">,</span> <span class="n">escape</span><span class="o">=</span><span class="kc">False</span><span class="p">)]</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">spec</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="ow">in</span> <span class="n">group</span><span class="p">):</span>
                    <span class="n">level</span> <span class="o">+=</span> <span class="mi">1</span>  <span class="c1"># Labels match</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="n">level</span>

<div class="viewcode-block" id="Compositor.match_level"><a class="viewcode-back" href="../../../reference_manual/holoviews.operation.html#holoviews.core.io.Compositor.match_level">[docs]</a>    <span class="k">def</span> <span class="nf">match_level</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">overlay</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        Given an overlay, return the match level and applicable slice</span>
<span class="sd">        of the overall overlay. The level an integer if there is a</span>
<span class="sd">        match or None if there is no match.</span>

<span class="sd">        The level integer is the number of matching components. Higher</span>
<span class="sd">        values indicate a stronger match.</span>
<span class="sd">        """</span>
        <span class="n">slice_width</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_pattern_spec</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">slice_width</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">overlay</span><span class="p">):</span> <span class="k">return</span> <span class="kc">None</span>

        <span class="c1"># Check all the possible slices and return the best matching one</span>
        <span class="n">best_lvl</span><span class="p">,</span> <span class="n">match_slice</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">overlay</span><span class="p">)</span><span class="o">-</span><span class="n">slice_width</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">overlay_slice</span> <span class="o">=</span> <span class="n">overlay</span><span class="o">.</span><span class="n">values</span><span class="p">()[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="n">slice_width</span><span class="p">]</span>
            <span class="n">lvl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_slice_match_level</span><span class="p">(</span><span class="n">overlay_slice</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">lvl</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="k">continue</span>
            <span class="k">if</span> <span class="n">lvl</span> <span class="o">&gt;</span> <span class="n">best_lvl</span><span class="p">:</span>
                <span class="n">best_lvl</span> <span class="o">=</span> <span class="n">lvl</span>
                <span class="n">match_slice</span> <span class="o">=</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">i</span><span class="o">+</span><span class="n">slice_width</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">(</span><span class="n">best_lvl</span><span class="p">,</span> <span class="n">match_slice</span><span class="p">)</span> <span class="k">if</span> <span class="n">best_lvl</span> <span class="o">!=</span> <span class="mi">0</span> <span class="k">else</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="Compositor.apply"><a class="viewcode-back" href="../../../reference_manual/holoviews.operation.html#holoviews.core.io.Compositor.apply">[docs]</a>    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">input_ranges</span><span class="p">,</span> <span class="n">backend</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        Apply the compositor on the input with the given input ranges.</span>
<span class="sd">        """</span>
        <span class="kn">from</span> <span class="nn">.overlay</span> <span class="kn">import</span> <span class="n">CompositeOverlay</span>
        <span class="k">if</span> <span class="n">backend</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">backend</span> <span class="o">=</span> <span class="n">Store</span><span class="o">.</span><span class="n">current_backend</span>
        <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">k</span> <span class="o">!=</span> <span class="s1">'output_type'</span><span class="p">}</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">CompositeOverlay</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">values</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">transfer_parameters</span><span class="p">:</span>
                <span class="n">plot_opts</span> <span class="o">=</span> <span class="n">Store</span><span class="o">.</span><span class="n">lookup_options</span><span class="p">(</span><span class="n">backend</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="s1">'plot'</span><span class="p">)</span><span class="o">.</span><span class="n">kwargs</span>
                <span class="n">kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">plot_opts</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                               <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">operation</span><span class="o">.</span><span class="n">param</span><span class="p">})</span>

        <span class="n">transformed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">operation</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">input_ranges</span><span class="o">=</span><span class="n">input_ranges</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">transfer_options</span> <span class="ow">and</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">transformed</span><span class="p">:</span>
            <span class="n">Store</span><span class="o">.</span><span class="n">transfer_options</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">transformed</span><span class="p">,</span> <span class="n">backend</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">transformed</span></div></div>


<div class="viewcode-block" id="Store"><a class="viewcode-back" href="../../../reference_manual/holoviews.core.html#holoviews.core.io.Store">[docs]</a><span class="k">class</span> <span class="nc">Store</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    The Store is what links up HoloViews objects to their</span>
<span class="sd">    corresponding options and to the appropriate classes of the chosen</span>
<span class="sd">    backend (e.g. for rendering).</span>

<span class="sd">    In addition, Store supports pickle operations that automatically</span>
<span class="sd">    pickle and unpickle the corresponding options for a HoloViews</span>
<span class="sd">    object.</span>
<span class="sd">    """</span>

    <span class="n">renderers</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span> <span class="c1"># The set of available Renderers across all backends.</span>

    <span class="c1"># A mapping from ViewableElement types to their corresponding plot</span>
    <span class="c1"># types grouped by the backend. Set using the register method.</span>
    <span class="n">registry</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c1"># A list of formats to be published for display on the frontend (e.g</span>
    <span class="c1"># IPython Notebook or a GUI application)</span>
    <span class="n">display_formats</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'html'</span><span class="p">]</span>

    <span class="c1"># A mapping from Dimensioned type to display hook</span>
    <span class="n">_display_hooks</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">dict</span><span class="p">)</span>

    <span class="c1"># Once register_plotting_classes is called, this OptionTree is</span>
    <span class="c1"># populated for the given backend.</span>
    <span class="n">_options</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c1"># Weakrefs to record objects per id</span>
    <span class="n">_weakrefs</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">_options_context</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="c1"># Backend option caches</span>
    <span class="n">_lookup_cache</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c1"># A list of hooks to call after registering the plot and style options</span>
    <span class="n">option_setters</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># A dictionary of custom OptionTree by custom object id by backend</span>
    <span class="n">_custom_options</span> <span class="o">=</span> <span class="p">{</span><span class="s1">'matplotlib'</span><span class="p">:</span> <span class="p">{}}</span>
    <span class="n">load_counter_offset</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">save_option_state</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="n">current_backend</span> <span class="o">=</span> <span class="s1">'matplotlib'</span>

    <span class="n">_backend_switch_hooks</span> <span class="o">=</span> <span class="p">[]</span>

<div class="viewcode-block" id="Store.set_current_backend"><a class="viewcode-back" href="../../../reference_manual/holoviews.core.html#holoviews.core.io.Store.set_current_backend">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">set_current_backend</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">backend</span><span class="p">):</span>
        <span class="s2">"Use this method to set the backend to run the switch hooks"</span>
        <span class="k">for</span> <span class="n">hook</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_backend_switch_hooks</span><span class="p">:</span>
            <span class="n">hook</span><span class="p">(</span><span class="n">backend</span><span class="p">)</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">current_backend</span> <span class="o">=</span> <span class="n">backend</span></div>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">options</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">backend</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">backend</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">current_backend</span> <span class="k">if</span> <span class="n">backend</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">backend</span>
        <span class="k">if</span> <span class="n">val</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_options</span><span class="p">[</span><span class="n">backend</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">cls</span><span class="o">.</span><span class="n">_lookup_cache</span><span class="p">[</span><span class="n">backend</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="bp">cls</span><span class="o">.</span><span class="n">_options</span><span class="p">[</span><span class="n">backend</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>

<div class="viewcode-block" id="Store.loaded_backends"><a class="viewcode-back" href="../../../reference_manual/holoviews.core.html#holoviews.core.io.Store.loaded_backends">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">loaded_backends</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        Returns a list of the backends that have been loaded, based on</span>
<span class="sd">        the available OptionTrees.</span>
<span class="sd">        """</span>
        <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">_options</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span></div>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">custom_options</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">backend</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">backend</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">current_backend</span> <span class="k">if</span> <span class="n">backend</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">backend</span>
        <span class="k">if</span> <span class="n">val</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_custom_options</span><span class="p">[</span><span class="n">backend</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">cls</span><span class="o">.</span><span class="n">_custom_options</span><span class="p">[</span><span class="n">backend</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>

<div class="viewcode-block" id="Store.load"><a class="viewcode-back" href="../../../reference_manual/holoviews.core.html#holoviews.core.io.Store.load">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">load</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        Equivalent to pickle.load except that the HoloViews trees is</span>
<span class="sd">        restored appropriately.</span>
<span class="sd">        """</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">load_counter_offset</span> <span class="o">=</span> <span class="n">StoreOptions</span><span class="o">.</span><span class="n">id_offset</span><span class="p">()</span>
        <span class="n">val</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">load_counter_offset</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="n">val</span></div>

<div class="viewcode-block" id="Store.loads"><a class="viewcode-back" href="../../../reference_manual/holoviews.core.html#holoviews.core.io.Store.loads">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">loads</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">pickle_string</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        Equivalent to pickle.loads except that the HoloViews trees is</span>
<span class="sd">        restored appropriately.</span>
<span class="sd">        """</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">load_counter_offset</span> <span class="o">=</span> <span class="n">StoreOptions</span><span class="o">.</span><span class="n">id_offset</span><span class="p">()</span>
        <span class="n">val</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">pickle_string</span><span class="p">)</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">load_counter_offset</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="n">val</span></div>

<div class="viewcode-block" id="Store.dump"><a class="viewcode-back" href="../../../reference_manual/holoviews.core.html#holoviews.core.io.Store.dump">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">dump</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">file</span><span class="p">,</span> <span class="n">protocol</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        Equivalent to pickle.dump except that the HoloViews option</span>
<span class="sd">        tree is saved appropriately.</span>
<span class="sd">        """</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">save_option_state</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">file</span><span class="p">,</span> <span class="n">protocol</span><span class="o">=</span><span class="n">protocol</span><span class="p">)</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">save_option_state</span> <span class="o">=</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="Store.dumps"><a class="viewcode-back" href="../../../reference_manual/holoviews.core.html#holoviews.core.io.Store.dumps">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">dumps</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">protocol</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        Equivalent to pickle.dumps except that the HoloViews option</span>
<span class="sd">        tree is saved appropriately.</span>
<span class="sd">        """</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">save_option_state</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">val</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">protocol</span><span class="o">=</span><span class="n">protocol</span><span class="p">)</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">save_option_state</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="n">val</span></div>

<div class="viewcode-block" id="Store.info"><a class="viewcode-back" href="../../../reference_manual/holoviews.core.html#holoviews.core.io.Store.info">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">info</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">ansi</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">backend</span><span class="o">=</span><span class="s1">'matplotlib'</span><span class="p">,</span> <span class="n">visualization</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
             <span class="n">recursive</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">pattern</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">elements</span><span class="o">=</span><span class="p">[]):</span>
        <span class="sd">"""</span>
<span class="sd">        Show information about a particular object or component class</span>
<span class="sd">        including the applicable style and plot options. Returns None if</span>
<span class="sd">        the object is not parameterized.</span>
<span class="sd">        """</span>
        <span class="n">parameterized_object</span> <span class="o">=</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">param</span><span class="o">.</span><span class="n">Parameterized</span><span class="p">)</span>
        <span class="n">parameterized_class</span> <span class="o">=</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span><span class="nb">type</span><span class="p">)</span>
                               <span class="ow">and</span>  <span class="nb">issubclass</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span><span class="n">param</span><span class="o">.</span><span class="n">Parameterized</span><span class="p">))</span>
        <span class="n">info</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">parameterized_object</span> <span class="ow">or</span> <span class="n">parameterized_class</span><span class="p">:</span>
            <span class="n">info</span> <span class="o">=</span> <span class="n">InfoPrinter</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">ansi</span><span class="o">=</span><span class="n">ansi</span><span class="p">,</span> <span class="n">backend</span><span class="o">=</span><span class="n">backend</span><span class="p">,</span>
                                    <span class="n">visualization</span><span class="o">=</span><span class="n">visualization</span><span class="p">,</span>
                                    <span class="n">pattern</span><span class="o">=</span><span class="n">pattern</span><span class="p">,</span> <span class="n">elements</span><span class="o">=</span><span class="n">elements</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">parameterized_object</span> <span class="ow">and</span> <span class="n">recursive</span><span class="p">:</span>
            <span class="n">hierarchy</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">traverse</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">type</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
            <span class="n">listed</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">hierarchy</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
                <span class="k">if</span> <span class="n">c</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">listed</span><span class="p">:</span>
                    <span class="n">inner_info</span> <span class="o">=</span> <span class="n">InfoPrinter</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">ansi</span><span class="o">=</span><span class="n">ansi</span><span class="p">,</span> <span class="n">backend</span><span class="o">=</span><span class="n">backend</span><span class="p">,</span>
                                                  <span class="n">visualization</span><span class="o">=</span><span class="n">visualization</span><span class="p">,</span>
                                                  <span class="n">pattern</span><span class="o">=</span><span class="n">pattern</span><span class="p">)</span>
                    <span class="n">black</span> <span class="o">=</span> <span class="s1">'</span><span class="se">\x1b</span><span class="s1">[1;30m</span><span class="si">%s</span><span class="se">\x1b</span><span class="s1">[0m'</span> <span class="k">if</span> <span class="n">ansi</span> <span class="k">else</span> <span class="s1">'</span><span class="si">%s</span><span class="s1">'</span>
                    <span class="n">info</span> <span class="o">+=</span>  <span class="s1">'</span><span class="se">\n\n</span><span class="s1">'</span> <span class="o">+</span> <span class="p">(</span><span class="n">black</span> <span class="o">%</span> <span class="n">inner_info</span><span class="p">)</span>
                    <span class="n">listed</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">info</span></div>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">lookup_options</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">backend</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">group</span><span class="p">,</span> <span class="n">defaults</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="c1"># Current custom_options dict may not have entry for obj.id</span>
        <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">id</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_custom_options</span><span class="p">[</span><span class="n">backend</span><span class="p">]:</span>
            <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_custom_options</span><span class="p">[</span><span class="n">backend</span><span class="p">][</span><span class="n">obj</span><span class="o">.</span><span class="n">id</span><span class="p">]</span><span class="o">.</span><span class="n">closest</span><span class="p">(</span>
                <span class="n">obj</span><span class="p">,</span> <span class="n">group</span><span class="p">,</span> <span class="n">defaults</span><span class="p">,</span> <span class="n">backend</span><span class="o">=</span><span class="n">backend</span><span class="p">)</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="n">defaults</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">Options</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_options</span><span class="p">[</span><span class="n">backend</span><span class="p">]</span><span class="o">.</span><span class="n">closest</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">group</span><span class="p">,</span> <span class="n">defaults</span><span class="p">,</span> <span class="n">backend</span><span class="o">=</span><span class="n">backend</span><span class="p">)</span>

<div class="viewcode-block" id="Store.lookup"><a class="viewcode-back" href="../../../reference_manual/holoviews.core.html#holoviews.core.io.Store.lookup">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">lookup</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">backend</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        Given an object, lookup the corresponding customized option</span>
<span class="sd">        tree if a single custom tree is applicable.</span>
<span class="sd">        """</span>
        <span class="n">ids</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="n">el</span> <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="n">obj</span><span class="o">.</span><span class="n">traverse</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">id</span><span class="p">)</span> <span class="k">if</span> <span class="n">el</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">])</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ids</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">"Object does not own a custom options tree"</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">ids</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">idlist</span> <span class="o">=</span> <span class="s2">","</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">el</span><span class="p">)</span> <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">ids</span><span class="p">)])</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">"Object contains elements combined across "</span>
                            <span class="s2">"multiple custom trees (ids </span><span class="si">%s</span><span class="s2">)"</span> <span class="o">%</span> <span class="n">idlist</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_custom_options</span><span class="p">[</span><span class="n">backend</span><span class="p">][</span><span class="nb">list</span><span class="p">(</span><span class="n">ids</span><span class="p">)[</span><span class="mi">0</span><span class="p">]]</span></div>

<div class="viewcode-block" id="Store.transfer_options"><a class="viewcode-back" href="../../../reference_manual/holoviews.core.html#holoviews.core.io.Store.transfer_options">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">transfer_options</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">new_obj</span><span class="p">,</span> <span class="n">backend</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="mi">3</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        Transfers options for all backends from one object to another.</span>
<span class="sd">        Drops any options defined in the supplied drop list.</span>
<span class="sd">        """</span>
        <span class="k">if</span> <span class="n">obj</span> <span class="ow">is</span> <span class="n">new_obj</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="n">backend</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">current_backend</span> <span class="k">if</span> <span class="n">backend</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">backend</span>
        <span class="n">type_name</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="n">new_obj</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span>
        <span class="n">group</span> <span class="o">=</span> <span class="n">type_name</span> <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">group</span> <span class="o">==</span> <span class="nb">type</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span> <span class="k">else</span> <span class="n">obj</span><span class="o">.</span><span class="n">group</span>
        <span class="n">spec</span> <span class="o">=</span> <span class="s1">'.'</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">s</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="p">(</span><span class="n">type_name</span><span class="p">,</span> <span class="n">group</span><span class="p">,</span> <span class="n">obj</span><span class="o">.</span><span class="n">label</span><span class="p">)[:</span><span class="n">level</span><span class="p">]</span> <span class="k">if</span> <span class="n">s</span><span class="p">])</span>
        <span class="n">options</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">Options</span><span class="o">.</span><span class="n">_option_groups</span><span class="p">:</span>
            <span class="n">opts</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">lookup_options</span><span class="p">(</span><span class="n">backend</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">group</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">opts</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">new_opts</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">lookup_options</span><span class="p">(</span><span class="n">backend</span><span class="p">,</span> <span class="n">new_obj</span><span class="p">,</span> <span class="n">group</span><span class="p">,</span> <span class="n">defaults</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">existing</span> <span class="o">=</span> <span class="n">new_opts</span><span class="o">.</span><span class="n">kwargs</span> <span class="k">if</span> <span class="n">new_opts</span> <span class="k">else</span> <span class="p">{}</span>
            <span class="n">filtered</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">opts</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                        <span class="k">if</span> <span class="p">(</span><span class="n">names</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">names</span><span class="p">)</span> <span class="ow">and</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">existing</span><span class="p">}</span>
            <span class="k">if</span> <span class="n">filtered</span><span class="p">:</span>
                <span class="n">options</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Options</span><span class="p">(</span><span class="n">group</span><span class="p">,</span> <span class="o">**</span><span class="n">filtered</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">options</span><span class="p">:</span>
            <span class="n">StoreOptions</span><span class="o">.</span><span class="n">set_options</span><span class="p">(</span><span class="n">new_obj</span><span class="p">,</span> <span class="p">{</span><span class="n">spec</span><span class="p">:</span> <span class="n">options</span><span class="p">},</span> <span class="n">backend</span><span class="p">)</span></div>

<div class="viewcode-block" id="Store.add_style_opts"><a class="viewcode-back" href="../../../reference_manual/holoviews.core.html#holoviews.core.io.Store.add_style_opts">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">add_style_opts</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">component</span><span class="p">,</span> <span class="n">new_options</span><span class="p">,</span> <span class="n">backend</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        Given a component such as an Element (e.g. Image, Curve) or a</span>
<span class="sd">        container (e.g. Layout) specify new style options to be</span>
<span class="sd">        accepted by the corresponding plotting class.</span>

<span class="sd">        Note: This is supplied for advanced users who know which</span>
<span class="sd">        additional style keywords are appropriate for the</span>
<span class="sd">        corresponding plotting class.</span>
<span class="sd">        """</span>
        <span class="n">backend</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">current_backend</span> <span class="k">if</span> <span class="n">backend</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">backend</span>
        <span class="k">if</span> <span class="n">component</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">registry</span><span class="p">[</span><span class="n">backend</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">"Component </span><span class="si">{</span><span class="n">component</span><span class="si">!r}</span><span class="s2"> not registered to a plotting class."</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">new_options</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">el</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="n">new_options</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">"Please supply a list of style option keyword strings"</span>
            <span class="p">)</span>

        <span class="k">with</span> <span class="n">param</span><span class="o">.</span><span class="n">logging_level</span><span class="p">(</span><span class="s1">'CRITICAL'</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">option</span> <span class="ow">in</span> <span class="n">new_options</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">option</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">registry</span><span class="p">[</span><span class="n">backend</span><span class="p">][</span><span class="n">component</span><span class="p">]</span><span class="o">.</span><span class="n">style_opts</span><span class="p">:</span>
                    <span class="n">plot_class</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">registry</span><span class="p">[</span><span class="n">backend</span><span class="p">][</span><span class="n">component</span><span class="p">]</span>
                    <span class="n">plot_class</span><span class="o">.</span><span class="n">style_opts</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">plot_class</span><span class="o">.</span><span class="n">style_opts</span><span class="o">+</span><span class="p">[</span><span class="n">option</span><span class="p">])</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">_options</span><span class="p">[</span><span class="n">backend</span><span class="p">][</span><span class="n">component</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">Options</span><span class="p">(</span>
            <span class="s1">'style'</span><span class="p">,</span> <span class="n">merge_keywords</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">allowed_keywords</span><span class="o">=</span><span class="n">new_options</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="Store.register"><a class="viewcode-back" href="../../../reference_manual/holoviews.core.html#holoviews.core.io.Store.register">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">register</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">associations</span><span class="p">,</span> <span class="n">backend</span><span class="p">,</span> <span class="n">style_aliases</span><span class="o">=</span><span class="p">{}):</span>
        <span class="sd">"""</span>
<span class="sd">        Register the supplied dictionary of associations between</span>
<span class="sd">        elements and plotting classes to the specified backend.</span>
<span class="sd">        """</span>
        <span class="k">if</span> <span class="n">backend</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">registry</span><span class="p">:</span>
            <span class="bp">cls</span><span class="o">.</span><span class="n">registry</span><span class="p">[</span><span class="n">backend</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">registry</span><span class="p">[</span><span class="n">backend</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">associations</span><span class="p">)</span>

        <span class="n">groups</span> <span class="o">=</span> <span class="n">Options</span><span class="o">.</span><span class="n">_option_groups</span>
        <span class="k">if</span> <span class="n">backend</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_options</span><span class="p">:</span>
            <span class="bp">cls</span><span class="o">.</span><span class="n">_options</span><span class="p">[</span><span class="n">backend</span><span class="p">]</span> <span class="o">=</span> <span class="n">OptionTree</span><span class="p">([],</span> <span class="n">groups</span><span class="o">=</span><span class="n">groups</span><span class="p">,</span> <span class="n">backend</span><span class="o">=</span><span class="n">backend</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">backend</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_custom_options</span><span class="p">:</span>
            <span class="bp">cls</span><span class="o">.</span><span class="n">_custom_options</span><span class="p">[</span><span class="n">backend</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">for</span> <span class="n">view_class</span><span class="p">,</span> <span class="n">plot</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">registry</span><span class="p">[</span><span class="n">backend</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">expanded_opts</span> <span class="o">=</span> <span class="p">[</span><span class="n">opt</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">plot</span><span class="o">.</span><span class="n">style_opts</span>
                             <span class="k">for</span> <span class="n">opt</span> <span class="ow">in</span> <span class="n">style_aliases</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="p">[])]</span>
            <span class="n">style_opts</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">opt</span> <span class="k">for</span> <span class="n">opt</span> <span class="ow">in</span> <span class="p">(</span><span class="n">expanded_opts</span> <span class="o">+</span> <span class="n">plot</span><span class="o">.</span><span class="n">style_opts</span><span class="p">)</span>
                                    <span class="k">if</span> <span class="n">opt</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">plot</span><span class="o">.</span><span class="n">_disabled_opts</span><span class="p">))</span>

            <span class="c1"># Special handling for PlotSelector which just proxies parameters</span>
            <span class="n">params</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">plot</span><span class="o">.</span><span class="n">param</span><span class="p">)</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">plot</span><span class="p">,</span> <span class="s1">'param'</span><span class="p">)</span> <span class="k">else</span> <span class="n">plot</span><span class="o">.</span><span class="n">params</span><span class="p">()</span>
            <span class="n">plot_opts</span> <span class="o">=</span> <span class="p">[</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">params</span> <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">'name'</span><span class="p">]]</span>

            <span class="k">with</span> <span class="n">param</span><span class="o">.</span><span class="n">logging_level</span><span class="p">(</span><span class="s1">'CRITICAL'</span><span class="p">):</span>
                <span class="n">plot</span><span class="o">.</span><span class="n">style_opts</span> <span class="o">=</span> <span class="n">style_opts</span>

            <span class="n">plot_opts</span> <span class="o">=</span>  <span class="n">Keywords</span><span class="p">(</span><span class="n">plot_opts</span><span class="p">,</span>  <span class="n">target</span><span class="o">=</span><span class="n">view_class</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
            <span class="n">style_opts</span> <span class="o">=</span> <span class="n">Keywords</span><span class="p">(</span><span class="n">style_opts</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="n">view_class</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>

            <span class="n">opt_groups</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">'plot'</span><span class="p">:</span>   <span class="n">Options</span><span class="p">(</span><span class="n">allowed_keywords</span><span class="o">=</span><span class="n">plot_opts</span><span class="p">),</span>
                <span class="s1">'output'</span><span class="p">:</span> <span class="n">Options</span><span class="p">(</span><span class="n">allowed_keywords</span><span class="o">=</span><span class="n">Options</span><span class="o">.</span><span class="n">_output_allowed_kws</span><span class="p">),</span>
                <span class="s1">'style'</span><span class="p">:</span>  <span class="n">Options</span><span class="p">(</span><span class="n">allowed_keywords</span><span class="o">=</span><span class="n">style_opts</span><span class="p">),</span>
                <span class="s1">'norm'</span><span class="p">:</span>   <span class="n">Options</span><span class="p">(</span><span class="n">framewise</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">axiswise</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                  <span class="n">allowed_keywords</span><span class="o">=</span><span class="p">[</span><span class="s1">'framewise'</span><span class="p">,</span> <span class="s1">'axiswise'</span><span class="p">])</span>
            <span class="p">}</span>

            <span class="n">name</span> <span class="o">=</span> <span class="n">view_class</span><span class="o">.</span><span class="vm">__name__</span>
            <span class="bp">cls</span><span class="o">.</span><span class="n">_options</span><span class="p">[</span><span class="n">backend</span><span class="p">][</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">opt_groups</span></div>

<div class="viewcode-block" id="Store.set_display_hook"><a class="viewcode-back" href="../../../reference_manual/holoviews.core.html#holoviews.core.io.Store.set_display_hook">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">set_display_hook</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">group</span><span class="p">,</span> <span class="n">objtype</span><span class="p">,</span> <span class="n">hook</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        Specify a display hook that will be applied to objects of type</span>
<span class="sd">        objtype. The group specifies the set to which the display hook</span>
<span class="sd">        belongs, allowing the Store to compute the precedence within</span>
<span class="sd">        each group.</span>
<span class="sd">        """</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">_display_hooks</span><span class="p">[</span><span class="n">group</span><span class="p">][</span><span class="n">objtype</span><span class="p">]</span> <span class="o">=</span> <span class="n">hook</span></div>

<div class="viewcode-block" id="Store.render"><a class="viewcode-back" href="../../../reference_manual/holoviews.core.html#holoviews.core.io.Store.render">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">render</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        Using any display hooks that have been registered, render the</span>
<span class="sd">        object to a dictionary of MIME types and metadata information.</span>
<span class="sd">        """</span>
        <span class="n">class_hierarchy</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">getmro</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">obj</span><span class="p">))</span>
        <span class="n">hooks</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">type_hooks</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_display_hooks</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">for</span> <span class="bp">cls</span> <span class="ow">in</span> <span class="n">class_hierarchy</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">cls</span> <span class="ow">in</span> <span class="n">type_hooks</span><span class="p">:</span>
                    <span class="n">hooks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">type_hooks</span><span class="p">[</span><span class="bp">cls</span><span class="p">])</span>
                    <span class="k">break</span>

        <span class="n">data</span><span class="p">,</span> <span class="n">metadata</span> <span class="o">=</span> <span class="p">{},</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">hook</span> <span class="ow">in</span> <span class="n">hooks</span><span class="p">:</span>
            <span class="n">ret</span> <span class="o">=</span> <span class="n">hook</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">ret</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">d</span><span class="p">,</span> <span class="n">md</span> <span class="o">=</span> <span class="n">ret</span>
            <span class="n">data</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
            <span class="n">metadata</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">md</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">data</span><span class="p">,</span> <span class="n">metadata</span></div></div>


<div class="viewcode-block" id="StoreOptions"><a class="viewcode-back" href="../../../reference_manual/holoviews.core.html#holoviews.core.io.StoreOptions">[docs]</a><span class="k">class</span> <span class="nc">StoreOptions</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    A collection of utilities for advanced users for creating and</span>
<span class="sd">    setting customized option trees on the Store. Designed for use by</span>
<span class="sd">    either advanced users or the %opts line and cell magics which use</span>
<span class="sd">    this machinery.</span>

<span class="sd">    This class also holds general classmethods for working with</span>
<span class="sd">    OptionTree instances: as OptionTrees are designed for attribute</span>
<span class="sd">    access it is best to minimize the number of methods implemented on</span>
<span class="sd">    that class and implement the necessary utilities on StoreOptions</span>
<span class="sd">    instead.</span>

<span class="sd">    Lastly this class offers a means to record all OptionErrors</span>
<span class="sd">    generated by an option specification. This is used for validation</span>
<span class="sd">    purposes.</span>
<span class="sd">    """</span>

    <span class="c1">#=======================#</span>
    <span class="c1"># OptionError recording #</span>
    <span class="c1">#=======================#</span>

    <span class="n">_errors_recorded</span> <span class="o">=</span> <span class="kc">None</span>

<div class="viewcode-block" id="StoreOptions.start_recording_skipped"><a class="viewcode-back" href="../../../reference_manual/holoviews.core.html#holoviews.core.io.StoreOptions.start_recording_skipped">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">start_recording_skipped</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        Start collecting OptionErrors for all skipped options recorded</span>
<span class="sd">        with the record_skipped_option method</span>
<span class="sd">        """</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">_errors_recorded</span> <span class="o">=</span> <span class="p">[]</span></div>

<div class="viewcode-block" id="StoreOptions.stop_recording_skipped"><a class="viewcode-back" href="../../../reference_manual/holoviews.core.html#holoviews.core.io.StoreOptions.stop_recording_skipped">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">stop_recording_skipped</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        Stop collecting OptionErrors recorded with the</span>
<span class="sd">        record_skipped_option method and return them</span>
<span class="sd">        """</span>
        <span class="k">if</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_errors_recorded</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">'Cannot stop recording before it is started'</span><span class="p">)</span>
        <span class="n">recorded</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_errors_recorded</span><span class="p">[:]</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">_errors_recorded</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="n">recorded</span></div>

<div class="viewcode-block" id="StoreOptions.record_skipped_option"><a class="viewcode-back" href="../../../reference_manual/holoviews.core.html#holoviews.core.io.StoreOptions.record_skipped_option">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">record_skipped_option</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">error</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        Record the OptionError associated with a skipped option if</span>
<span class="sd">        currently recording</span>
<span class="sd">        """</span>
        <span class="k">if</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_errors_recorded</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">cls</span><span class="o">.</span><span class="n">_errors_recorded</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">error</span><span class="p">)</span></div>

    <span class="c1">#===============#</span>
    <span class="c1"># ID management #</span>
    <span class="c1">#===============#</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">get_object_ids</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">set</span><span class="p">(</span><span class="n">el</span> <span class="k">for</span> <span class="n">el</span>
                   <span class="ow">in</span> <span class="n">obj</span><span class="o">.</span><span class="n">traverse</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="s1">'id'</span><span class="p">,</span> <span class="kc">None</span><span class="p">)))</span>

<div class="viewcode-block" id="StoreOptions.tree_to_dict"><a class="viewcode-back" href="../../../reference_manual/holoviews.core.html#holoviews.core.io.StoreOptions.tree_to_dict">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">tree_to_dict</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">tree</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        Given an OptionTree, convert it into the equivalent dictionary format.</span>
<span class="sd">        """</span>
        <span class="n">specs</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">tree</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">spec_key</span> <span class="o">=</span> <span class="s1">'.'</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
            <span class="n">specs</span><span class="p">[</span><span class="n">spec_key</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">grp</span> <span class="ow">in</span> <span class="n">tree</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">groups</span><span class="p">:</span>
                <span class="n">kwargs</span> <span class="o">=</span> <span class="n">tree</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">groups</span><span class="p">[</span><span class="n">grp</span><span class="p">]</span><span class="o">.</span><span class="n">kwargs</span>
                <span class="k">if</span> <span class="n">kwargs</span><span class="p">:</span>
                    <span class="n">specs</span><span class="p">[</span><span class="n">spec_key</span><span class="p">][</span><span class="n">grp</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span>
        <span class="k">return</span> <span class="n">specs</span></div>

<div class="viewcode-block" id="StoreOptions.propagate_ids"><a class="viewcode-back" href="../../../reference_manual/holoviews.core.html#holoviews.core.io.StoreOptions.propagate_ids">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">propagate_ids</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">match_id</span><span class="p">,</span> <span class="n">new_id</span><span class="p">,</span> <span class="n">applied_keys</span><span class="p">,</span> <span class="n">backend</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        Recursively propagate an id through an object for components</span>
<span class="sd">        matching the applied_keys. This method can only be called if</span>
<span class="sd">        there is a tree with a matching id in Store.custom_options</span>
<span class="sd">        """</span>
        <span class="n">applied</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">def</span> <span class="nf">propagate</span><span class="p">(</span><span class="n">o</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">o</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="n">match_id</span> <span class="ow">or</span> <span class="p">(</span><span class="n">o</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">==</span> <span class="s1">'DynamicMap'</span><span class="p">):</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="s1">'id'</span><span class="p">,</span> <span class="n">new_id</span><span class="p">)</span>
                <span class="n">applied</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">o</span><span class="p">)</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">traverse</span><span class="p">(</span><span class="n">propagate</span><span class="p">,</span> <span class="n">specs</span><span class="o">=</span><span class="nb">set</span><span class="p">(</span><span class="n">applied_keys</span><span class="p">)</span> <span class="o">|</span> <span class="p">{</span><span class="s1">'DynamicMap'</span><span class="p">})</span>

        <span class="c1"># Clean up the custom tree if it was not applied</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">new_id</span> <span class="ow">in</span> <span class="n">Store</span><span class="o">.</span><span class="n">custom_options</span><span class="p">(</span><span class="n">backend</span><span class="o">=</span><span class="n">backend</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">AssertionError</span><span class="p">(</span><span class="s2">"New option id </span><span class="si">%d</span><span class="s2"> does not match any "</span>
                                 <span class="s2">"option trees in Store.custom_options."</span>
                                 <span class="o">%</span> <span class="n">new_id</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">applied</span></div>

<div class="viewcode-block" id="StoreOptions.capture_ids"><a class="viewcode-back" href="../../../reference_manual/holoviews.core.html#holoviews.core.io.StoreOptions.capture_ids">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">capture_ids</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        Given an list of ids, capture a list of ids that can be</span>
<span class="sd">        restored using the restore_ids.</span>
<span class="sd">        """</span>
        <span class="k">return</span> <span class="n">obj</span><span class="o">.</span><span class="n">traverse</span><span class="p">(</span><span class="k">lambda</span> <span class="n">o</span><span class="p">:</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="s1">'id'</span><span class="p">))</span></div>

<div class="viewcode-block" id="StoreOptions.restore_ids"><a class="viewcode-back" href="../../../reference_manual/holoviews.core.html#holoviews.core.io.StoreOptions.restore_ids">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">restore_ids</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">ids</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        Given an list of ids as captured with capture_ids, restore the</span>
<span class="sd">        ids. Note the structure of an object must not change between</span>
<span class="sd">        the calls to capture_ids and restore_ids.</span>
<span class="sd">        """</span>
        <span class="n">ids</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">(</span><span class="n">ids</span><span class="p">)</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">traverse</span><span class="p">(</span><span class="k">lambda</span> <span class="n">o</span><span class="p">:</span> <span class="nb">setattr</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="s1">'id'</span><span class="p">,</span> <span class="nb">next</span><span class="p">(</span><span class="n">ids</span><span class="p">)))</span></div>

<div class="viewcode-block" id="StoreOptions.apply_customizations"><a class="viewcode-back" href="../../../reference_manual/holoviews.core.html#holoviews.core.io.StoreOptions.apply_customizations">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">apply_customizations</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">spec</span><span class="p">,</span> <span class="n">options</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        Apply the given option specs to the supplied options tree.</span>
<span class="sd">        """</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">spec</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">spec</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
                <span class="n">customization</span> <span class="o">=</span> <span class="p">{</span><span class="n">v</span><span class="o">.</span><span class="n">key</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">spec</span><span class="p">[</span><span class="n">key</span><span class="p">]}</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">customization</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="p">(</span><span class="n">Options</span><span class="p">(</span><span class="o">**</span><span class="n">v</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="k">else</span> <span class="n">v</span><span class="p">)</span>
                                 <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">spec</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>

            <span class="c1"># Set the Keywords target on Options from the {type} part of the key.</span>
            <span class="n">customization</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span><span class="o">.</span><span class="n">keywords_target</span><span class="p">(</span><span class="n">key</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">'.'</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
                             <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">customization</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
            <span class="n">options</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">key</span><span class="p">)]</span> <span class="o">=</span> <span class="n">customization</span>
        <span class="k">return</span> <span class="n">options</span></div>

<div class="viewcode-block" id="StoreOptions.validate_spec"><a class="viewcode-back" href="../../../reference_manual/holoviews.core.html#holoviews.core.io.StoreOptions.validate_spec">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">validate_spec</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">spec</span><span class="p">,</span> <span class="n">backends</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        Given a specification, validated it against the options tree for</span>
<span class="sd">        the specified backends by raising OptionError for invalid</span>
<span class="sd">        options. If backends is None, validates against all the</span>
<span class="sd">        currently loaded backend.</span>

<span class="sd">        Only useful when invalid keywords generate exceptions instead of</span>
<span class="sd">        skipping, i.e. Options.skip_invalid is False.</span>
<span class="sd">        """</span>
        <span class="n">loaded_backends</span> <span class="o">=</span> <span class="n">Store</span><span class="o">.</span><span class="n">loaded_backends</span><span class="p">()</span> <span class="k">if</span> <span class="n">backends</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">backends</span>

        <span class="n">error_info</span>     <span class="o">=</span> <span class="p">{}</span>
        <span class="n">backend_errors</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">set</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">backend</span> <span class="ow">in</span> <span class="n">loaded_backends</span><span class="p">:</span>
            <span class="bp">cls</span><span class="o">.</span><span class="n">start_recording_skipped</span><span class="p">()</span>
            <span class="k">with</span> <span class="n">options_policy</span><span class="p">(</span><span class="n">skip_invalid</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">warn_on_skip</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
                <span class="n">options</span> <span class="o">=</span> <span class="n">OptionTree</span><span class="p">(</span>
                    <span class="n">items</span><span class="o">=</span><span class="n">Store</span><span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="n">backend</span><span class="p">)</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span>
                    <span class="n">groups</span><span class="o">=</span><span class="n">Store</span><span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="n">backend</span><span class="p">)</span><span class="o">.</span><span class="n">groups</span><span class="p">,</span>
                    <span class="n">backend</span><span class="o">=</span><span class="n">backend</span>
                <span class="p">)</span>
                <span class="bp">cls</span><span class="o">.</span><span class="n">apply_customizations</span><span class="p">(</span><span class="n">spec</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">error</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">stop_recording_skipped</span><span class="p">():</span>
                <span class="n">error_key</span> <span class="o">=</span> <span class="p">(</span><span class="n">error</span><span class="o">.</span><span class="n">invalid_keyword</span><span class="p">,</span>
                             <span class="n">error</span><span class="o">.</span><span class="n">allowed_keywords</span><span class="o">.</span><span class="n">target</span><span class="p">,</span>
                             <span class="n">error</span><span class="o">.</span><span class="n">group_name</span><span class="p">)</span>
                <span class="n">error_info</span><span class="p">[</span><span class="n">error_key</span><span class="o">+</span><span class="p">(</span><span class="n">backend</span><span class="p">,)]</span> <span class="o">=</span> <span class="n">error</span><span class="o">.</span><span class="n">allowed_keywords</span>
                <span class="n">backend_errors</span><span class="p">[</span><span class="n">error_key</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">backend</span><span class="p">)</span>

        <span class="k">for</span> <span class="p">((</span><span class="n">keyword</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">group_name</span><span class="p">),</span> <span class="n">backends</span><span class="p">)</span> <span class="ow">in</span> <span class="n">backend_errors</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="c1"># If the keyword failed for the target across all loaded backends...</span>
            <span class="k">if</span> <span class="nb">set</span><span class="p">(</span><span class="n">backends</span><span class="p">)</span> <span class="o">==</span> <span class="nb">set</span><span class="p">(</span><span class="n">loaded_backends</span><span class="p">):</span>
                <span class="n">key</span> <span class="o">=</span> <span class="p">(</span><span class="n">keyword</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">group_name</span><span class="p">,</span> <span class="n">Store</span><span class="o">.</span><span class="n">current_backend</span><span class="p">)</span>
                <span class="k">raise</span> <span class="n">OptionError</span><span class="p">(</span><span class="n">keyword</span><span class="p">,</span>
                                  <span class="n">group_name</span><span class="o">=</span><span class="n">group_name</span><span class="p">,</span>
                                  <span class="n">allowed_keywords</span><span class="o">=</span><span class="n">error_info</span><span class="p">[</span><span class="n">key</span><span class="p">])</span></div>


<div class="viewcode-block" id="StoreOptions.validation_error_message"><a class="viewcode-back" href="../../../reference_manual/holoviews.core.html#holoviews.core.io.StoreOptions.validation_error_message">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">validation_error_message</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">spec</span><span class="p">,</span> <span class="n">backends</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        Returns an options validation error message if there are any</span>
<span class="sd">        invalid keywords. Otherwise returns None.</span>
<span class="sd">        """</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">cls</span><span class="o">.</span><span class="n">validate_spec</span><span class="p">(</span><span class="n">spec</span><span class="p">,</span> <span class="n">backends</span><span class="o">=</span><span class="n">backends</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">OptionError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">e</span><span class="o">.</span><span class="n">format_options_error</span><span class="p">()</span></div>

<div class="viewcode-block" id="StoreOptions.expand_compositor_keys"><a class="viewcode-back" href="../../../reference_manual/holoviews.core.html#holoviews.core.io.StoreOptions.expand_compositor_keys">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">expand_compositor_keys</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">spec</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        Expands compositor definition keys into {type}.{group}</span>
<span class="sd">        keys. For instance a compositor operation returning a group</span>
<span class="sd">        string 'Image' of element type RGB expands to 'RGB.Image'.</span>
<span class="sd">        """</span>
        <span class="n">expanded_spec</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">applied_keys</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">compositor_defs</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">el</span><span class="o">.</span><span class="n">group</span><span class="p">:</span> <span class="n">el</span><span class="o">.</span><span class="n">output_type</span><span class="o">.</span><span class="vm">__name__</span> <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="n">Compositor</span><span class="o">.</span><span class="n">definitions</span>
        <span class="p">}</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">spec</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">compositor_defs</span><span class="p">:</span>
                <span class="n">expanded_spec</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Send id to Overlays</span>
                <span class="n">applied_keys</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'Overlay'</span><span class="p">]</span>
                <span class="n">type_name</span> <span class="o">=</span> <span class="n">compositor_defs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
                <span class="n">expanded_spec</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">type_name</span><span class="o">+</span><span class="s1">'.'</span><span class="o">+</span><span class="n">key</span><span class="p">)]</span> <span class="o">=</span> <span class="n">val</span>
        <span class="k">return</span> <span class="n">expanded_spec</span><span class="p">,</span> <span class="n">applied_keys</span></div>

<div class="viewcode-block" id="StoreOptions.create_custom_trees"><a class="viewcode-back" href="../../../reference_manual/holoviews.core.html#holoviews.core.io.StoreOptions.create_custom_trees">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">create_custom_trees</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">backend</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        Returns the appropriate set of customized subtree clones for</span>
<span class="sd">        an object, suitable for merging with Store.custom_options (i.e</span>
<span class="sd">        with the ids appropriately offset). Note if an object has no</span>
<span class="sd">        integer ids a new OptionTree is built.</span>

<span class="sd">        The id_mapping return value is a list mapping the ids that</span>
<span class="sd">        need to be matched as set to their new values.</span>
<span class="sd">        """</span>
        <span class="n">clones</span><span class="p">,</span> <span class="n">id_mapping</span> <span class="o">=</span> <span class="p">{},</span> <span class="p">[]</span>
        <span class="n">obj_ids</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">get_object_ids</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
        <span class="n">offset</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">id_offset</span><span class="p">()</span>
        <span class="n">obj_ids</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">obj_ids</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">obj_ids</span>

        <span class="n">used_obj_types</span> <span class="o">=</span> <span class="p">[(</span><span class="n">opt</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">'.'</span><span class="p">)[</span><span class="mi">0</span><span class="p">],)</span> <span class="k">for</span> <span class="n">opt</span> <span class="ow">in</span> <span class="n">options</span><span class="p">]</span>
        <span class="n">backend</span> <span class="o">=</span> <span class="n">backend</span> <span class="ow">or</span> <span class="n">Store</span><span class="o">.</span><span class="n">current_backend</span>
        <span class="n">available_options</span> <span class="o">=</span> <span class="n">Store</span><span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="n">backend</span><span class="o">=</span><span class="n">backend</span><span class="p">)</span>
        <span class="n">used_options</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">obj_type</span> <span class="ow">in</span> <span class="n">available_options</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">obj_type</span> <span class="ow">in</span> <span class="n">used_obj_types</span><span class="p">:</span>
                <span class="n">opts_groups</span> <span class="o">=</span> <span class="n">available_options</span><span class="p">[</span><span class="n">obj_type</span><span class="p">]</span><span class="o">.</span><span class="n">groups</span>
                <span class="n">used_options</span><span class="p">[</span><span class="n">obj_type</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="n">grp</span><span class="p">:</span> <span class="n">Options</span><span class="p">(</span>
                        <span class="n">allowed_keywords</span><span class="o">=</span><span class="n">opt</span><span class="o">.</span><span class="n">allowed_keywords</span><span class="p">,</span>
                        <span class="n">backend</span><span class="o">=</span><span class="n">backend</span><span class="p">,</span>
                    <span class="p">)</span>
                    <span class="k">for</span> <span class="p">(</span><span class="n">grp</span><span class="p">,</span> <span class="n">opt</span><span class="p">)</span> <span class="ow">in</span> <span class="n">opts_groups</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                <span class="p">}</span>

        <span class="n">custom_options</span> <span class="o">=</span> <span class="n">Store</span><span class="o">.</span><span class="n">custom_options</span><span class="p">(</span><span class="n">backend</span><span class="o">=</span><span class="n">backend</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">tree_id</span> <span class="ow">in</span> <span class="n">obj_ids</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">tree_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">tree_id</span> <span class="ow">in</span> <span class="n">custom_options</span><span class="p">:</span>
                <span class="n">original</span> <span class="o">=</span> <span class="n">custom_options</span><span class="p">[</span><span class="n">tree_id</span><span class="p">]</span>
                <span class="n">clone</span> <span class="o">=</span> <span class="n">OptionTree</span><span class="p">(</span>
                    <span class="n">items</span><span class="o">=</span><span class="n">original</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span>
                    <span class="n">groups</span><span class="o">=</span><span class="n">original</span><span class="o">.</span><span class="n">groups</span><span class="p">,</span>
                    <span class="n">backend</span><span class="o">=</span><span class="n">original</span><span class="o">.</span><span class="n">backend</span>
                <span class="p">)</span>
                <span class="n">clones</span><span class="p">[</span><span class="n">tree_id</span> <span class="o">+</span> <span class="n">offset</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">clone</span>
                <span class="n">id_mapping</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">tree_id</span><span class="p">,</span> <span class="n">tree_id</span> <span class="o">+</span> <span class="n">offset</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">clone</span> <span class="o">=</span> <span class="n">OptionTree</span><span class="p">(</span><span class="n">groups</span><span class="o">=</span><span class="n">available_options</span><span class="o">.</span><span class="n">groups</span><span class="p">,</span>
                                   <span class="n">backend</span><span class="o">=</span><span class="n">backend</span><span class="p">)</span>
                <span class="n">clones</span><span class="p">[</span><span class="n">offset</span><span class="p">]</span> <span class="o">=</span> <span class="n">clone</span>
                <span class="n">id_mapping</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">tree_id</span><span class="p">,</span> <span class="n">offset</span><span class="p">))</span>

            <span class="c1"># Nodes needed to ensure allowed_keywords is respected</span>
            <span class="k">for</span> <span class="n">obj_type</span><span class="p">,</span> <span class="n">opts</span> <span class="ow">in</span> <span class="n">used_options</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">clone</span><span class="p">[</span><span class="n">obj_type</span><span class="p">]</span> <span class="o">=</span> <span class="n">opts</span>

        <span class="k">return</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="bp">cls</span><span class="o">.</span><span class="n">apply_customizations</span><span class="p">(</span><span class="n">options</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span> <span class="k">if</span> <span class="n">options</span> <span class="k">else</span> <span class="n">t</span>
                <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">t</span> <span class="ow">in</span> <span class="n">clones</span><span class="o">.</span><span class="n">items</span><span class="p">()},</span> <span class="n">id_mapping</span></div>

<div class="viewcode-block" id="StoreOptions.merge_options"><a class="viewcode-back" href="../../../reference_manual/holoviews.core.html#holoviews.core.io.StoreOptions.merge_options">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">merge_options</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">groups</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        Given a full options dictionary and options groups specified</span>
<span class="sd">        as a keywords, return the full set of merged options:</span>

<span class="sd">        &gt;&gt;&gt; options={'Curve':{'style':dict(color='b')}}</span>
<span class="sd">        &gt;&gt;&gt; style={'Curve':{'linewidth':10 }}</span>
<span class="sd">        &gt;&gt;&gt; merged = StoreOptions.merge_options(['style'], options, style=style)</span>
<span class="sd">        &gt;&gt;&gt; sorted(merged['Curve']['style'].items())</span>
<span class="sd">        [('color', 'b'), ('linewidth', 10)]</span>
<span class="sd">        """</span>
        <span class="n">groups</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">groups</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">options</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">set</span><span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">&lt;=</span> <span class="n">groups</span><span class="p">):</span>
            <span class="n">kwargs</span><span class="p">,</span> <span class="n">options</span> <span class="o">=</span> <span class="n">options</span><span class="p">,</span> <span class="kc">None</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">options</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">any</span><span class="p">(</span><span class="n">k</span> <span class="ow">in</span> <span class="n">groups</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">options</span><span class="p">)):</span>
              <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                  <span class="sa">f</span><span class="s2">"All keys must be a subset of </span><span class="si">{</span><span class="s1">', '</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">groups</span><span class="p">)</span><span class="si">}</span><span class="s2">."</span>
              <span class="p">)</span>

        <span class="n">options</span> <span class="o">=</span> <span class="p">{}</span> <span class="k">if</span> <span class="p">(</span><span class="n">options</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="k">else</span> <span class="nb">dict</span><span class="p">(</span><span class="o">**</span><span class="n">options</span><span class="p">)</span>
        <span class="n">all_keys</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">k</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">values</span><span class="p">()</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">d</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">spec_key</span> <span class="ow">in</span> <span class="n">all_keys</span><span class="p">:</span>
            <span class="n">additions</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">spec_key</span> <span class="ow">in</span> <span class="n">d</span><span class="p">:</span>
                    <span class="n">kws</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="n">spec_key</span><span class="p">]</span>
                    <span class="n">additions</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">k</span><span class="p">:</span><span class="n">kws</span><span class="p">})</span>
            <span class="k">if</span> <span class="n">spec_key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">options</span><span class="p">:</span>
                <span class="n">options</span><span class="p">[</span><span class="n">spec_key</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">additions</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">options</span><span class="p">[</span><span class="n">spec_key</span><span class="p">]:</span>
                    <span class="n">options</span><span class="p">[</span><span class="n">spec_key</span><span class="p">][</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">additions</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">options</span><span class="p">[</span><span class="n">spec_key</span><span class="p">][</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">additions</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">options</span></div>


<div class="viewcode-block" id="StoreOptions.state"><a class="viewcode-back" href="../../../reference_manual/holoviews.core.html#holoviews.core.io.StoreOptions.state">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">state</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">state</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        Method to capture and restore option state. When called</span>
<span class="sd">        without any state supplied, the current state is</span>
<span class="sd">        returned. Then if this state is supplied back in a later call</span>
<span class="sd">        using the same object, the original state is restored.</span>
<span class="sd">        """</span>
        <span class="k">if</span> <span class="n">state</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ids</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">capture_ids</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
            <span class="n">original_custom_keys</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">Store</span><span class="o">.</span><span class="n">custom_options</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">ids</span><span class="p">,</span> <span class="n">original_custom_keys</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="p">(</span><span class="n">ids</span><span class="p">,</span> <span class="n">original_custom_keys</span><span class="p">)</span> <span class="o">=</span> <span class="n">state</span>
            <span class="n">current_custom_keys</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">Store</span><span class="o">.</span><span class="n">custom_options</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">current_custom_keys</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="n">original_custom_keys</span><span class="p">):</span>
                <span class="k">del</span> <span class="n">Store</span><span class="o">.</span><span class="n">custom_options</span><span class="p">()[</span><span class="n">key</span><span class="p">]</span>
                <span class="bp">cls</span><span class="o">.</span><span class="n">restore_ids</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">ids</span><span class="p">)</span></div>

<div class="viewcode-block" id="StoreOptions.options"><a class="viewcode-back" href="../../../reference_manual/holoviews.core.html#holoviews.core.io.StoreOptions.options">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="nd">@contextmanager</span>
    <span class="k">def</span> <span class="nf">options</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        Context-manager for temporarily setting options on an object</span>
<span class="sd">        (if options is None, no options will be set) . Once the</span>
<span class="sd">        context manager exits, both the object and the Store will be</span>
<span class="sd">        left in exactly the same state they were in before the context</span>
<span class="sd">        manager was used.</span>

<span class="sd">        See holoviews.core.options.set_options function for more</span>
<span class="sd">        information on the options specification format.</span>
<span class="sd">        """</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">options</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">Store</span><span class="o">.</span><span class="n">_options_context</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">optstate</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">state</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
            <span class="n">groups</span> <span class="o">=</span> <span class="n">Store</span><span class="o">.</span><span class="n">options</span><span class="p">()</span><span class="o">.</span><span class="n">groups</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
            <span class="n">options</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">merge_options</span><span class="p">(</span><span class="n">groups</span><span class="p">,</span> <span class="n">options</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="bp">cls</span><span class="o">.</span><span class="n">set_options</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">yield</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">options</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">Store</span><span class="o">.</span><span class="n">_options_context</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="bp">cls</span><span class="o">.</span><span class="n">state</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">state</span><span class="o">=</span><span class="n">optstate</span><span class="p">)</span></div>

<div class="viewcode-block" id="StoreOptions.id_offset"><a class="viewcode-back" href="../../../reference_manual/holoviews.core.html#holoviews.core.io.StoreOptions.id_offset">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">id_offset</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        Compute an appropriate offset for future id values given the set</span>
<span class="sd">        of ids currently defined across backends.</span>
<span class="sd">        """</span>
        <span class="n">max_ids</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">backend</span> <span class="ow">in</span> <span class="n">Store</span><span class="o">.</span><span class="n">renderers</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">store_ids</span> <span class="o">=</span> <span class="n">Store</span><span class="o">.</span><span class="n">custom_options</span><span class="p">(</span><span class="n">backend</span><span class="o">=</span><span class="n">backend</span><span class="p">)</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
            <span class="n">max_id</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">store_ids</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">store_ids</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span>
            <span class="n">max_ids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">max_id</span><span class="p">)</span>
        <span class="c1"># If no backends defined (e.g. plotting not imported) return zero</span>
        <span class="k">return</span> <span class="nb">max</span><span class="p">(</span><span class="n">max_ids</span><span class="p">)</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">max_ids</span><span class="p">)</span> <span class="k">else</span> <span class="mi">0</span></div>

<div class="viewcode-block" id="StoreOptions.update_backends"><a class="viewcode-back" href="../../../reference_manual/holoviews.core.html#holoviews.core.io.StoreOptions.update_backends">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">update_backends</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">id_mapping</span><span class="p">,</span> <span class="n">custom_trees</span><span class="p">,</span> <span class="n">backend</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        Given the id_mapping from previous ids to new ids and the new</span>
<span class="sd">        custom tree dictionary, update the current backend with the</span>
<span class="sd">        supplied trees and update the keys in the remaining backends to</span>
<span class="sd">        stay linked with the current object.</span>
<span class="sd">        """</span>
        <span class="n">backend</span> <span class="o">=</span> <span class="n">Store</span><span class="o">.</span><span class="n">current_backend</span> <span class="k">if</span> <span class="n">backend</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">backend</span>
        <span class="c1"># Update the custom option entries for the current backend</span>
        <span class="n">Store</span><span class="o">.</span><span class="n">custom_options</span><span class="p">(</span><span class="n">backend</span><span class="o">=</span><span class="n">backend</span><span class="p">)</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">custom_trees</span><span class="p">)</span>
        <span class="n">Store</span><span class="o">.</span><span class="n">_lookup_cache</span><span class="p">[</span><span class="n">backend</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># Propagate option ids for non-selected backends</span>
        <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">Store</span><span class="o">.</span><span class="n">loaded_backends</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">b</span> <span class="o">==</span> <span class="n">backend</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">backend_trees</span> <span class="o">=</span> <span class="n">Store</span><span class="o">.</span><span class="n">_custom_options</span><span class="p">[</span><span class="n">b</span><span class="p">]</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">old_id</span><span class="p">,</span> <span class="n">new_id</span><span class="p">)</span> <span class="ow">in</span> <span class="n">id_mapping</span><span class="p">:</span>
                <span class="n">tree</span> <span class="o">=</span> <span class="n">backend_trees</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">old_id</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">tree</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">backend_trees</span><span class="p">[</span><span class="n">new_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">tree</span></div>

<div class="viewcode-block" id="StoreOptions.set_options"><a class="viewcode-back" href="../../../reference_manual/holoviews.core.html#holoviews.core.io.StoreOptions.set_options">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">set_options</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">backend</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        Pure Python function for customize HoloViews objects in terms of</span>
<span class="sd">        their style, plot and normalization options.</span>

<span class="sd">        The options specification is a dictionary containing the target</span>
<span class="sd">        for customization as a {type}.{group}.{label} keys. An example of</span>
<span class="sd">        such a key is 'Image' which would customize all Image components</span>
<span class="sd">        in the object. The key 'Image.Channel' would only customize Images</span>
<span class="sd">        in the object that have the group 'Channel'.</span>

<span class="sd">        The corresponding value is then a list of Option objects specified</span>
<span class="sd">        with an appropriate category ('plot', 'style' or 'norm'). For</span>
<span class="sd">        instance, using the keys described above, the specs could be:</span>

<span class="sd">        {'Image:[Options('style', cmap='jet')]}</span>

<span class="sd">        Or setting two types of option at once:</span>

<span class="sd">        {'Image.Channel':[Options('plot', size=50),</span>
<span class="sd">                          Options('style', cmap='Blues')]}</span>


<span class="sd">        Relationship to the %%opts magic</span>
<span class="sd">        ----------------------------------</span>

<span class="sd">        This function matches the functionality supplied by the %%opts</span>
<span class="sd">        cell magic in the IPython extension. In fact, you can use the same</span>
<span class="sd">        syntax as the IPython cell magic to achieve the same customization</span>
<span class="sd">        as shown above:</span>

<span class="sd">        from holoviews.util.parser import OptsSpec</span>
<span class="sd">        set_options(my_image, OptsSpec.parse("Image (cmap='jet')"))</span>

<span class="sd">        Then setting both plot and style options:</span>

<span class="sd">        set_options(my_image, OptsSpec.parse("Image [size=50] (cmap='Blues')"))</span>
<span class="sd">        """</span>
        <span class="c1"># Note that an alternate, more verbose and less recommended</span>
        <span class="c1"># syntax can also be used:</span>

        <span class="c1"># {'Image.Channel:{'plot':  Options(size=50),</span>
        <span class="c1">#                  'style': Options('style', cmap='Blues')]}</span>
        <span class="n">groups</span> <span class="o">=</span> <span class="n">Store</span><span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="n">backend</span><span class="o">=</span><span class="n">backend</span><span class="p">)</span><span class="o">.</span><span class="n">groups</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
        <span class="n">options</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">merge_options</span><span class="p">(</span><span class="n">groups</span><span class="p">,</span> <span class="n">options</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">spec</span><span class="p">,</span> <span class="n">compositor_applied</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">expand_compositor_keys</span><span class="p">(</span><span class="n">options</span><span class="p">)</span>
        <span class="n">custom_trees</span><span class="p">,</span> <span class="n">id_mapping</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">create_custom_trees</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">spec</span><span class="p">,</span> <span class="n">backend</span><span class="o">=</span><span class="n">backend</span><span class="p">)</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">update_backends</span><span class="p">(</span><span class="n">id_mapping</span><span class="p">,</span> <span class="n">custom_trees</span><span class="p">,</span> <span class="n">backend</span><span class="o">=</span><span class="n">backend</span><span class="p">)</span>

        <span class="c1"># Propagate ids to the objects</span>
        <span class="n">not_used</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">match_id</span><span class="p">,</span> <span class="n">new_id</span><span class="p">)</span> <span class="ow">in</span> <span class="n">id_mapping</span><span class="p">:</span>
            <span class="n">key</span> <span class="o">=</span> <span class="n">compositor_applied</span><span class="o">+</span><span class="nb">list</span><span class="p">(</span><span class="n">spec</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
            <span class="n">applied</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">propagate_ids</span><span class="p">(</span>
                <span class="n">obj</span><span class="p">,</span> <span class="n">match_id</span><span class="p">,</span> <span class="n">new_id</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">backend</span><span class="o">=</span><span class="n">backend</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">applied</span><span class="p">:</span>
                <span class="n">not_used</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_id</span><span class="p">)</span>

        <span class="c1"># Clean up unused custom option trees</span>
        <span class="k">for</span> <span class="n">new_id</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="n">not_used</span><span class="p">):</span>
            <span class="n">cleanup_custom_options</span><span class="p">(</span><span class="n">new_id</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">obj</span></div></div>
</pre></div>
</div>
<!-- Previous / next buttons -->
<div class="prev-next-area">
</div>
</main>
</div>
</div>
<script src="../../../_static/js/index.be7d3bbb2ef33a8344ce.js"></script>
<footer class="footer mt-5 mt-md-0">
<div class="container">
<div class="footer-item">
<p class="copyright">
    Â© Copyright 2021 HoloViz developers.<br/>
</p>
</div>
<div class="footer-item">
<p class="sphinx-version">
Created using <a href="http://sphinx-doc.org/">Sphinx</a> 4.3.1.<br/>
</p>
</div>
</div>
</footer>
</body>
</html>